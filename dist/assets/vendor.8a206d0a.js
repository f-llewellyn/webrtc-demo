/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(sd){o(sd)}}function a(t){try{u(r.throw(t))}catch(sd){o(sd)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(sd){o=[6,sd],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=a(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var u=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(sd){return!1}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var l=function(t){function n(e,r,i){var o=t.call(this,r)||this;return o.code=e,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,f.prototype.create),o}return e(n,t),n}(Error),f=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?p(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new l(i,a,r);return u},t}();function p(t,e){return t.replace(d,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var d=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function v(t,e){var n=new g(t,e);return n.subscribe.bind(n)}var g=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=m),void 0===r.error&&(r.error=m),void 0===r.complete&&(r.complete=m);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(sd){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(sd){"undefined"!=typeof console&&console.error&&console.error(sd)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function m(){}var b=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),w=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new u;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(sd){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=n({identifier:"[DEFAULT]",optional:!1},t),r=e.identifier,i=e.optional,o=this.normalizeInstanceIdentifier(r);try{var s=this.getOrInitializeService({instanceIdentifier:o});if(!s){if(i)return null;throw Error("Service "+this.name+" is not available")}return s}catch(sd){if(i)return null;throw sd}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(sd){}try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var s=o(i.value,2),a=s[0],u=s[1],c=this.normalizeInstanceIdentifier(a);try{var h=this.getOrInitializeService({instanceIdentifier:c});u.resolve(h)}catch(sd){}}}catch(l){e={error:l}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(s(s([],o(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),o(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t="[DEFAULT]"),this.instances.has(t)},t.prototype.initialize=function(t){void 0===t&&(t={});var e=t.instanceIdentifier,n=void 0===e?"[DEFAULT]":e,r=t.options,i=void 0===r?{}:r,o=this.normalizeInstanceIdentifier(n);if(this.isInitialized(o))throw Error(this.name+"("+o+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");return this.getOrInitializeService({instanceIdentifier:o,options:i})},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);return!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,"[DEFAULT]"===e?void 0:e),options:i}),this.instances.set(n,o)),o||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var E,I=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new w(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function T(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _,S,D=[];(S=_||(_={}))[S.DEBUG=0]="DEBUG",S[S.VERBOSE=1]="VERBOSE",S[S.INFO=2]="INFO",S[S.WARN=3]="WARN",S[S.ERROR=4]="ERROR",S[S.SILENT=5]="SILENT";var A,N={debug:_.DEBUG,verbose:_.VERBOSE,info:_.INFO,warn:_.WARN,error:_.ERROR,silent:_.SILENT},C=_.INFO,k=((E={})[_.DEBUG]="log",E[_.VERBOSE]="log",E[_.INFO]="info",E[_.WARN]="warn",E[_.ERROR]="error",E),x=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=k[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,T(["["+i+"]  "+t.name+":"],n))}},O=function(){function t(t){this.name=t,this._logLevel=C,this._logHandler=x,this._userLogHandler=null,D.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in _))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?N[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,T([this,_.DEBUG],t)),this._logHandler.apply(this,T([this,_.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,T([this,_.VERBOSE],t)),this._logHandler.apply(this,T([this,_.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,T([this,_.INFO],t)),this._logHandler.apply(this,T([this,_.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,T([this,_.WARN],t)),this._logHandler.apply(this,T([this,_.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,T([this,_.ERROR],t)),this._logHandler.apply(this,T([this,_.ERROR],t))},t}();function L(t){D.forEach((function(e){e.setLogLevel(t)}))}var R,P=((A={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",A["bad-app-name"]="Illegal App name: '{$appName}",A["duplicate-app"]="Firebase App named '{$appName}' already exists",A["app-deleted"]="Firebase App named '{$appName}' already deleted",A["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",A["invalid-log-argument"]="First argument to `onLog` must be null or a function.",A),M=new f("app","Firebase",P),F=((R={})["@firebase/app"]="fire-core",R["@firebase/analytics"]="fire-analytics",R["@firebase/auth"]="fire-auth",R["@firebase/database"]="fire-rtdb",R["@firebase/functions"]="fire-fn",R["@firebase/installations"]="fire-iid",R["@firebase/messaging"]="fire-fcm",R["@firebase/performance"]="fire-perf",R["@firebase/remote-config"]="fire-rc",R["@firebase/storage"]="fire-gcs",R["@firebase/firestore"]="fire-fst",R["fire-js"]="fire-js",R["firebase-wrapper"]="fire-js-all",R),V=new O("@firebase/app"),U=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=a(void 0,t),this.container=new I(e.name),this._addComponent(new b("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(t){return r._addComponent(t)}))}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(sd){V.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,sd)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw M.create("app-deleted",{appName:this.name_})},t}();U.prototype.name&&U.prototype.options||U.prototype.delete||console.log("dc");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function q(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var o=i;void 0===o.name&&(o.name="[DEFAULT]");var s=o.name;if("string"!=typeof s||!s)throw M.create("bad-app-name",{appName:String(s)});if(y(e,s))throw M.create("duplicate-app",{appName:s});var a=new t(n,o,r);return e[s]=a,a},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=F[t])&&void 0!==r?r:t;n&&(i+="-"+n);var s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return s&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&a&&u.push("and"),a&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void V.warn(u.join(" "))}o(new b(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:L,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw M.create("invalid-log-argument");!function(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=N[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(e){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:_[n].toLowerCase(),message:s,args:i,type:e.name})}},r=0,i=D;r<i.length;r++)n(i[r])}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e)},apps:null,SDK_VERSION:"8.3.1",INTERNAL:{registerComponent:o,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function i(t){if(!y(e,t=t||"[DEFAULT]"))throw M.create("no-app",{appName:t});return e[t]}function o(o){var s=o.name;if(n.has(s))return V.debug("There were multiple attempts to register component "+s+"."),"PUBLIC"===o.type?r[s]:null;if(n.set(s,o),"PUBLIC"===o.type){var u=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[s])throw M.create("invalid-app-argument",{appName:s});return t[s]()};void 0!==o.serviceProps&&a(u,o.serviceProps),r[s]=u,t.prototype[s]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,s);return n.apply(this,o.multipleInstances?t:[])}}for(var c=0,h=Object.keys(e);c<h.length;c++){var l=h[c];e[l]._addComponent(o)}return"PUBLIC"===o.type?r[s]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var j=function t(){var e=q(U);return e.INTERNAL=n(n({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){a(e,t)},createSubscribe:v,ErrorFactory:f,deepExtend:a}),e}(),B=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if("object"==typeof self&&self.self===self&&void 0!==self.firebase){V.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var K=self.firebase.SDK_VERSION;K&&K.indexOf("LITE")>=0&&V.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var G=j.initializeApp;j.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return h()&&V.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),G.apply(void 0,t)};var z,Q,H=j;(z=H).INTERNAL.registerComponent(new b("platform-logger",(function(t){return new B(t)}),"PRIVATE")),z.registerVersion("@firebase/app","0.6.17",Q),z.registerVersion("fire-js","");
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
H.registerVersion("firebase","8.3.1","app");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var W=function(t,e){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function Y(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var X,J="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},$=$||{},Z=J||self;function tt(){}function et(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function nt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var rt="closure_uid_"+(1e9*Math.random()>>>0),it=0;function ot(t,e,n){return t.call.apply(t.bind,arguments)}function st(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function at(t,e,n){return(at=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ot:st).apply(null,arguments)}function ut(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function ct(){return Date.now()}function ht(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function lt(){this.j=this.j,this.i=this.i}lt.prototype.j=!1,lt.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,rt)&&t[rt]||(t[rt]=++it))},lt.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var ft=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},pt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function dt(t){return Array.prototype.concat.apply([],arguments)}function yt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function vt(t){return/^[\s\xa0]*$/.test(t)}var gt,mt=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function bt(t,e){return-1!=t.indexOf(e)}function wt(t,e){return t<e?-1:t>e?1:0}t:{var Et=Z.navigator;if(Et){var It=Et.userAgent;if(It){gt=It;break t}}gt=""}function Tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function _t(t){var e={};for(var n in t)e[n]=t[n];return e}var St="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Dt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<St.length;o++)n=St[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function At(t){return At[" "](t),t}At[" "]=tt;var Nt,Ct,kt=bt(gt,"Opera"),xt=bt(gt,"Trident")||bt(gt,"MSIE"),Ot=bt(gt,"Edge"),Lt=Ot||xt,Rt=bt(gt,"Gecko")&&!(bt(gt.toLowerCase(),"webkit")&&!bt(gt,"Edge"))&&!(bt(gt,"Trident")||bt(gt,"MSIE"))&&!bt(gt,"Edge"),Pt=bt(gt.toLowerCase(),"webkit")&&!bt(gt,"Edge");function Mt(){var t=Z.document;return t?t.documentMode:void 0}t:{var Ft="",Vt=(Ct=gt,Rt?/rv:([^\);]+)(\)|;)/.exec(Ct):Ot?/Edge\/([\d\.]+)/.exec(Ct):xt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ct):Pt?/WebKit\/(\S+)/.exec(Ct):kt?/(?:Version)[ \/]?(\S+)/.exec(Ct):void 0);if(Vt&&(Ft=Vt?Vt[1]:""),xt){var Ut=Mt();if(null!=Ut&&Ut>parseFloat(Ft)){Nt=String(Ut);break t}}Nt=Ft}var qt,jt={};function Bt(t){return function(t,e){var n=jt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=mt(String(Nt)).split("."),r=mt(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=wt(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||wt(0==s[2].length,0==a[2].length)||wt(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}if(Z.document&&xt){var Kt=Mt();qt=Kt||(parseInt(Nt,10)||void 0)}else qt=void 0;var Gt=qt,zt=!xt||9<=Number(Gt),Qt=xt&&!Bt("9"),Ht=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Z.addEventListener("test",tt,e),Z.removeEventListener("test",tt,e)}catch(n){}return t}();function Wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Yt(t,e){if(Wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Rt){t:{try{At(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Xt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Wt.prototype.b=function(){this.defaultPrevented=!0},ht(Yt,Wt);var Xt={2:"touch",3:"pen",4:"mouse"};Yt.prototype.b=function(){Yt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Qt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Jt="closure_listenable_"+(1e6*Math.random()|0),$t=0;function Zt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++$t,this.Y=this.Z=!1}function te(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function ee(t){this.src=t,this.a={},this.b=0}function ne(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=ft(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(te(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function re(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}ee.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=re(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Zt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var ie="closure_lm_"+(1e6*Math.random()|0),oe={};function se(t,e,n,r,i){if(r&&r.once)return ue(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)se(t,e[o],n,r,i);return null}return n=ve(n),t&&t[Jt]?t.va(e,n,nt(r)?!!r.capture:!!r,i):ae(t,e,n,!1,r,i)}function ae(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=nt(i)?!!i.capture:!!i;if(s&&!zt)return null;var a=de(t);if(a||(t[ie]=a=new ee(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=pe,e=zt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Ht||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(le(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ue(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)ue(t,e[o],n,r,i);return null}return n=ve(n),t&&t[Jt]?t.wa(e,n,nt(r)?!!r.capture:!!r,i):ae(t,e,n,!0,r,i)}function ce(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)ce(t,e[o],n,r,i);else r=nt(r)?!!r.capture:!!r,n=ve(n),t&&t[Jt]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=re(o=t.a[e],n,r,i))&&(te(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=de(t))&&(e=t.a[e.toString()],t=-1,e&&(t=re(e,n,r,i)),(n=-1<t?e[t]:null)&&he(n))}function he(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Jt])ne(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(le(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=de(e))?(ne(n,t),0==n.b&&(n.src=null,e[ie]=null)):te(t)}}}function le(t){return t in oe?oe[t]:oe[t]="on"+t}function fe(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&he(t),n.call(r,e)}function pe(t,e){if(t.Y)return!0;if(!zt){if(!e)t:{e=["window","event"];for(var n=Z,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return fe(t,e=new Yt(e,this))}return fe(t,new Yt(e,this))}function de(t){return(t=t[ie])instanceof ee?t:null}var ye="__closure_events_fn_"+(1e9*Math.random()>>>0);function ve(t){return"function"==typeof t?t:(t[ye]||(t[ye]=function(e){return t.handleEvent(e)}),t[ye])}function ge(){lt.call(this),this.c=new ee(this),this.J=this,this.C=null}function me(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new Wt(e,t);else if(e instanceof Wt)e.target=e.target||t;else{var i=e;Dt(e=new Wt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=be(s,r,!0,e)&&i}if(i=be(s=e.a=t,r,!0,e)&&i,i=be(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=be(s=e.a=n[o],r,!1,e)&&i}function be(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&ne(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ht(ge,lt),ge.prototype[Jt]=!0,(X=ge.prototype).addEventListener=function(t,e,n,r){se(this,t,e,n,r)},X.removeEventListener=function(t,e,n,r){ce(this,t,e,n,r)},X.G=function(){if(ge.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)te(n[r]);delete e.a[t],e.b--}}this.C=null},X.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},X.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var we=Z.JSON.stringify;function Ee(){this.b=this.a=null}var Ie,Te=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Se}),(function(t){t.reset()}));function _e(){var t=Ce,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Se(){this.next=this.b=this.a=null}function De(t){Z.setTimeout((function(){throw t}),0)}function Ae(t,e){Ie||function(){var t=Z.Promise.resolve(void 0);Ie=function(){t.then(ke)}}(),Ne||(Ie(),Ne=!0),Ce.add(t,e)}Ee.prototype.add=function(t,e){var n=Te.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Se.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Se.prototype.reset=function(){this.next=this.b=this.a=null};var Ne=!1,Ce=new Ee;function ke(){for(var t;t=_e();){try{t.a.call(t.b)}catch(n){De(n)}var e=Te;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ne=!1}function xe(t,e){ge.call(this),this.b=t||1,this.a=e||Z,this.f=at(this.Za,this),this.g=ct()}function Oe(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Le(t,e,n){if("function"==typeof t)n&&(t=at(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=at(t.handleEvent,t)}return 2147483647<Number(e)?-1:Z.setTimeout(t,e||0)}function Re(t){t.a=Le((function(){t.a=null,t.c&&(t.c=!1,Re(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}ht(xe,ge),(X=xe.prototype).aa=!1,X.M=null,X.Za=function(){if(this.aa){var t=ct()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),me(this,"tick"),this.aa&&(Oe(this),this.start()))}},X.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=ct())},X.G=function(){xe.X.G.call(this),Oe(this),delete this.a};var Pe=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}W(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:Re(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(Z.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(lt);function Me(t){lt.call(this),this.b=t,this.a={}}ht(Me,lt);var Fe=[];function Ve(t,e,n,r){Array.isArray(n)||(n&&(Fe[0]=n.toString()),n=Fe);for(var i=0;i<n.length;i++){var o=se(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Ue(t){Tt(t.a,(function(t,e){this.a.hasOwnProperty(e)&&he(t)}),t),t.a={}}function qe(){this.a=!0}function je(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return we(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Me.prototype.G=function(){Me.X.G.call(this),Ue(this)},Me.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qe.prototype.info=function(){};var Be={},Ke=null;function Ge(){return Ke=Ke||new ge}function ze(t){Wt.call(this,Be.Fa,t)}function Qe(t){var e=Ge();me(e,new ze(e,t))}function He(t,e){Wt.call(this,Be.STAT_EVENT,t),this.stat=e}function We(t){var e=Ge();me(e,new He(e,t))}function Ye(t){Wt.call(this,Be.Ga,t)}function Xe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Z.setTimeout((function(){t()}),e)}Be.Fa="serverreachability",ht(ze,Wt),Be.STAT_EVENT="statevent",ht(He,Wt),Be.Ga="timingevent",ht(Ye,Wt);var Je={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},$e={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Ze(){}function tn(t){var e;return(e=t.a)||(e=t.a={}),e}function en(){}Ze.prototype.a=null;var nn,rn={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function on(){Wt.call(this,"d")}function sn(){Wt.call(this,"c")}function an(){}function un(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Me(this),this.P=cn,t=Lt?125:void 0,this.R=new xe(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}ht(on,Wt),ht(sn,Wt),ht(an,Ze),nn=new an;var cn=45e3,hn={},ln={};function fn(t,e,n){t.H=1,t.i=Rn(Nn(e)),t.j=n,t.I=!0,pn(t,null)}function pn(t,e){t.u=ct(),vn(t),t.l=Nn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),Hn(n.b,"t",r),t.D=0,t.a=jr(t.g,t.g.C?e:null),0<t.O&&(t.F=new Pe(at(t.Ca,t,t.a),t.O)),Ve(t.J,t.a,"readystatechange",t.Xa),e=t.B?_t(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Qe(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function dn(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=yn(t,n);if(i==ln){4==e&&(t.h=4,We(14),r=!1),je(t.c,t.f,null,"[Incomplete Response]");break}if(i==hn){t.h=4,We(15),je(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}je(t.c,t.f,i,null),En(t,i)}4==e&&0==n.length&&(t.h=1,We(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Lr(e),e.F=!0,We(11))):(je(t.c,t.f,n,"[Invalid Chunked Response]"),wn(t),bn(t))}function yn(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?ln:(n=Number(e.substring(n,r)),isNaN(n)?hn:(r+=1)+n>e.length?ln:(e=e.substr(r,n),t.D=r+n,e))}function vn(t){t.T=ct()+t.P,gn(t,t.P)}function gn(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Xe(at(t.Va,t),e)}function mn(t){t.o&&(Z.clearTimeout(t.o),t.o=null)}function bn(t){0==t.g.v||t.A||Mr(t.g,t)}function wn(t){mn(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Oe(t.R),Ue(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function En(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||tr(n.b,t)))if(n.I=t.N,!t.C&&tr(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(v){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Pr(n),_r(n)}Or(n),We(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=Xe(at(n.Sa,n),6e3));if(1>=Zn(n.b)&&n.ea){try{n.ea()}catch(v){}n.ea=void 0}}else Vr(n,11)}else if((t.C||n.a==t)&&Pr(n),!vt(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(bt(h,"spdy")||bt(h,"quic")||bt(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(er(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Ln(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=ct()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((u=n).la=qr(u,u.C?u.ga:null,u.fa),p.C){nr(u.b,p);var d=p,y=u.D;y&&d.setTimeout(y),d.o&&(mn(d),vn(d)),u.a=p}else xr(u);0<n.g.length&&Ar(n)}else"stop"!=i[0]&&"close"!=i[0]||Vr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Vr(n,7):Tr(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);Qe(4)}catch(v){}}function In(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(et(t)||"string"==typeof t)pt(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(et(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(et(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Tn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Tn)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function _n(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Sn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Sn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Sn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(X=un.prototype).setTimeout=function(t){this.P=t},X.Xa=function(t){t=t.target;var e=this.F;e&&3==br(t)?e.f():this.Ca(t)},X.Ca=function(t){try{if(t==this.a)t:{var e=br(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!Lt&&!this.a.$())){this.A||4!=e||7==n||Qe(8==n||0>=r?3:2),mn(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!vt(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,We(12),wn(this),bn(this);break t}je(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,En(this,u)}this.I?(dn(this,e,o),Lt&&this.b&&3==e&&(Ve(this.J,this.R,"tick",this.Wa),this.R.start())):(je(this.c,this.f,o,null),En(this,o)),4==e&&wn(this),this.b&&!this.A&&(4==e?Mr(this.g,this):(this.b=!1,vn(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,We(12)):(this.h=0,We(13)),wn(this),bn(this)}}}catch(c){}},X.Wa=function(){if(this.a){var t=br(this.a),e=this.a.$();this.D<e.length&&(mn(this),dn(this,t,e),this.b&&4!=t&&vn(this))}},X.cancel=function(){this.A=!0,wn(this)},X.Va=function(){this.o=null;var t=ct();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(Qe(3),We(17)),wn(this),this.h=2,bn(this)):gn(this,this.T-t)},(X=Tn.prototype).K=function(){_n(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},X.L=function(){return _n(this),this.a.concat()},X.get=function(t,e){return Sn(this.b,t)?this.b[t]:e},X.set=function(t,e){Sn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},X.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function An(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof An){this.a=void 0!==e?e:t.a,Cn(this,t.f),this.j=t.j,kn(this,t.c),xn(this,t.h),this.g=t.g,e=t.b;var n=new Kn;n.c=e.c,e.a&&(n.a=new Tn(e.a),n.b=e.b),On(this,n),this.i=t.i}else t&&(n=String(t).match(Dn))?(this.a=!!e,Cn(this,n[1]||"",!0),this.j=Pn(n[2]||""),kn(this,n[3]||"",!0),xn(this,n[4]),this.g=Pn(n[5]||"",!0),On(this,n[6]||"",!0),this.i=Pn(n[7]||"")):(this.a=!!e,this.b=new Kn(null,this.a))}function Nn(t){return new An(t)}function Cn(t,e,n){t.f=n?Pn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function kn(t,e,n){t.c=n?Pn(e,!0):e}function xn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function On(t,e,n){e instanceof Kn?(t.b=e,function(t,e){e&&!t.f&&(Gn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(zn(this,e),Hn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=Mn(e,jn)),t.b=new Kn(e,t.a))}function Ln(t,e,n){t.b.set(e,n)}function Rn(t){return Ln(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^ct()).toString(36)),t}function Pn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Mn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Fn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Fn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}An.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Mn(e,Vn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Mn(e,Vn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Mn(n,"/"==n.charAt(0)?qn:Un,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Mn(n,Bn)),t.join("")};var Vn=/[#\/\?@]/g,Un=/[#\?:]/g,qn=/[#\?]/g,jn=/[#\?@]/g,Bn=/#/g;function Kn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Gn(t){t.a||(t.a=new Tn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function zn(t,e){Gn(t),e=Wn(t,e),Sn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Sn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&_n(t)))}function Qn(t,e){return Gn(t),e=Wn(t,e),Sn(t.a.b,e)}function Hn(t,e,n){zn(t,e),0<n.length&&(t.c=null,t.a.set(Wn(t,e),yt(n)),t.b+=n.length)}function Wn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(X=Kn.prototype).add=function(t,e){Gn(this),this.c=null,t=Wn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},X.forEach=function(t,e){Gn(this),this.a.forEach((function(n,r){pt(n,(function(n){t.call(e,n,r,this)}),this)}),this)},X.L=function(){Gn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},X.K=function(t){Gn(this);var e=[];if("string"==typeof t)Qn(this,t)&&(e=dt(e,this.a.get(Wn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=dt(e,t[n])}return e},X.set=function(t,e){return Gn(this),this.c=null,Qn(this,t=Wn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},X.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},X.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var Yn=function(t,e){this.b=t,this.a=e};function Xn(t){this.g=t||Jn,Z.PerformanceNavigationTiming?t=0<(t=Z.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(Z.ia&&Z.ia.ya&&Z.ia.ya()&&Z.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Jn=10;function $n(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Zn(t){return t.b?1:t.a?t.a.size:0}function tr(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function er(t,e){t.a?t.a.add(e):t.b=e}function nr(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function rr(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=Y(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return yt(t.c)}function ir(){}function or(){this.a=new ir}function sr(t,e,n){var r=n||"";try{In(t,(function(t,n){var i=t;nt(t)&&(i=we(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(sd){throw e.push(r+"type="+encodeURIComponent("_badmap")),sd}}function ar(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}Xn.prototype.cancel=function(){var t,e;if(this.c=rr(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=Y(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},ir.prototype.stringify=function(t){return Z.JSON.stringify(t,void 0)},ir.prototype.parse=function(t){return Z.JSON.parse(t,void 0)};var ur=Z.JSON.parse;function cr(t){ge.call(this),this.headers=new Tn,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=hr,this.D=this.F=!1}ht(cr,ge);var hr="",lr=/^https?$/i,fr=["POST","PUT"];function pr(t){return"content-type"==t.toLowerCase()}function dr(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,yr(t),gr(t)}function yr(t){t.u||(t.u=!0,me(t,"complete"),me(t,"error"))}function vr(t){if(t.b&&void 0!==$&&(!t.s[1]||4!=br(t)||2!=t.W()))if(t.l&&4==br(t))Le(t.za,0,t);else if(me(t,"readystatechange"),4==br(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(Dn)[1]||null;if(!o&&Z.self&&Z.self.location){var s=Z.self.location.protocol;o=s.substr(0,s.length-1)}i=!lr.test(o?o.toLowerCase():"")}e=i}if(e)me(t,"complete"),me(t,"success");else{t.h=6;try{var a=2<br(t)?t.a.statusText:""}catch(u){a=""}t.f=a+" ["+t.W()+"]",yr(t)}}finally{gr(t)}}}function gr(t,e){if(t.a){mr(t);var n=t.a,r=t.s[0]?tt:null;t.a=null,t.s=null,e||me(t,"ready");try{n.onreadystatechange=r}catch(sd){}}}function mr(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(Z.clearTimeout(t.m),t.m=null)}function br(t){return t.a?t.a.readyState:0}function wr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Tt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ln(t,e,n))}function Er(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ir(t){this.pa=0,this.g=[],this.c=new qe,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Er("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Er("baseRetryDelayMs",5e3,t),this.Ra=Er("retryDelaySeedMs",1e4,t),this.Ma=Er("forwardChannelMaxRetries",2,t),this.ma=Er("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new Xn(t&&t.concurrentRequestLimit),this.ka=new or,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Tr(t){if(Sr(t),3==t.v){var e=t.R++,n=Nn(t.B);Ln(n,"SID",t.J),Ln(n,"RID",e),Ln(n,"TYPE","terminate"),Cr(t,n),(e=new un(t,t.c,e,void 0)).H=2,e.i=Rn(Nn(n)),n=!1,Z.navigator&&Z.navigator.sendBeacon&&(n=Z.navigator.sendBeacon(e.i.toString(),"")),!n&&Z.Image&&((new Image).src=e.i,n=!0),n||(e.a=jr(e.g,null),e.a.ba(e.i)),e.u=ct(),vn(e)}Ur(t)}function _r(t){t.a&&(Lr(t),t.a.cancel(),t.a=null)}function Sr(t){_r(t),t.j&&(Z.clearTimeout(t.j),t.j=null),Pr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&Z.clearTimeout(t.h),t.h=null)}function Dr(t,e){t.g.push(new Yn(t.Oa++,e)),3==t.v&&Ar(t)}function Ar(t){$n(t.b)||t.h||(t.h=!0,Ae(t.Ba,t),t.u=0)}function Nr(t,e){var n;n=e?e.f:t.R++;var r=Nn(t.B);Ln(r,"SID",t.J),Ln(r,"RID",n),Ln(r,"AID",t.P),Cr(t,r),t.i&&t.l&&wr(r,t.i,t.l),n=new un(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=kr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),er(t.b,n),fn(n,r,e)}function Cr(t,e){t.f&&In({},(function(t,n){Ln(e,n,t)}))}function kr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?at(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{sr(h,s,"req"+c+"_")}catch(l){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function xr(t){t.a||t.j||(t.T=1,Ae(t.Aa,t),t.o=0)}function Or(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=Xe(at(t.Aa,t),Fr(t,t.o)),t.o++,!0)}function Lr(t){null!=t.s&&(Z.clearTimeout(t.s),t.s=null)}function Rr(t){t.a=new un(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Nn(t.la);Ln(e,"RID","rpc"),Ln(e,"SID",t.J),Ln(e,"CI",t.H?"0":"1"),Ln(e,"AID",t.P),Cr(t,e),Ln(e,"TYPE","xmlhttp"),t.i&&t.l&&wr(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Rn(Nn(e)),n.j=null,n.I=!0,pn(n,t)}function Pr(t){null!=t.m&&(Z.clearTimeout(t.m),t.m=null)}function Mr(t,e){var n=null;if(t.a==e){Pr(t),Lr(t),t.a=null;var r=2}else{if(!tr(t.b,e))return;n=e.s,nr(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=ct()-e.u;var i=t.u;me(r=Ge(),new Ye(r,n,e,i)),Ar(t)}else xr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Zn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=Xe(at(t.Ba,t,e),Fr(t,t.u)),t.u++,0)))}(t,e)||2==r&&Or(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Vr(t,5);break;case 4:Vr(t,10);break;case 3:Vr(t,6);break;default:Vr(t,2)}}function Fr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function Vr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=at(t.Ya,t);n||(n=new An("//www.google.com/images/cleardot.gif"),Z.location&&"http"==Z.location.protocol||Cn(n,"https"),Rn(n)),function(t,e){var n=new qe;if(Z.Image){var r=new Image;r.onload=ut(ar,n,r,"TestLoadImage: loaded",!0,e),r.onerror=ut(ar,n,r,"TestLoadImage: error",!1,e),r.onabort=ut(ar,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=ut(ar,n,r,"TestLoadImage: timeout",!1,e),Z.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else We(2);t.v=0,t.f&&t.f.ra(e),Ur(t),Sr(t)}function Ur(t){t.v=0,t.I=-1,t.f&&(0==rr(t.b).length&&0==t.g.length||(t.b.c.length=0,yt(t.g),t.g.length=0),t.f.qa())}function qr(t,e,n){var r=function(t){return t instanceof An?Nn(t):new An(t,void 0)}(n);if(""!=r.c)e&&kn(r,e+"."+r.c),xn(r,r.h);else{var i=Z.location;r=function(t,e,n,r){var i=new An(null,void 0);return t&&Cn(i,t),e&&kn(i,e),n&&xn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&Tt(t.V,(function(t,e){Ln(r,e,t)})),e=t.A,n=t.na,e&&n&&Ln(r,e,n),Ln(r,"VER",t.ha),Cr(t,r),r}function jr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new cr(t.Na)).F=t.C,e}function Br(){}function Kr(){if(xt&&!(10<=Number(Gt)))throw Error("Environmental error: no available transport.")}function Gr(t,e){ge.call(this),this.a=new Ir(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!vt(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!vt(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Hr(this)}function zr(t){on.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Qr(){sn.call(this),this.status=1}function Hr(t){this.a=t}(X=cr.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?tn(this.H):tn(nn),this.a.onreadystatechange=at(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void dr(this,o)}t=n||"";var i=new Tn(this.headers);r&&In(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=pr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=Z.FormData&&t instanceof Z.FormData,!(0<=ft(fr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{mr(this),0<this.o&&((this.D=function(t){return xt&&Bt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=at(this.xa,this)):this.m=Le(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){dr(this,o)}},X.xa=function(){void 0!==$&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,me(this,"timeout"),this.abort(8))},X.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,me(this,"complete"),me(this,"abort"),gr(this))},X.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),gr(this,!0)),cr.X.G.call(this)},X.za=function(){this.j||(this.A||this.l||this.g?vr(this):this.Ua())},X.Ua=function(){vr(this)},X.W=function(){try{return 2<br(this)?this.a.status:-1}catch(Ct){return-1}},X.$=function(){try{return this.a?this.a.responseText:""}catch(Ct){return""}},X.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),ur(e)}},X.ua=function(){return this.h},X.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(X=Ir.prototype).ha=8,X.v=1,X.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new un(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Dt(r=_t(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=kr(this,n,e),Ln(i=Nn(this.B),"RID",t),Ln(i,"CVER",22),this.A&&Ln(i,"X-HTTP-Session-Id",this.A),Cr(this,i),this.i&&r&&wr(i,this.i,r),er(this.b,n),this.Ia&&Ln(i,"TYPE","init"),this.da?(Ln(i,"$req",e),Ln(i,"SID","null"),n.U=!0,fn(n,i,null)):fn(n,i,e),this.v=2}}else 3==this.v&&(t?Nr(this,t):0==this.g.length||$n(this.b)||Nr(this))},X.Aa=function(){if(this.j=null,Rr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Xe(at(this.Ta,this),t)}},X.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,We(10),_r(this),Rr(this))},X.Sa=function(){null!=this.m&&(this.m=null,_r(this),Or(this),We(19))},X.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),We(2)):(this.c.info("Failed to ping google.com"),We(1))},(X=Br.prototype).ta=function(){},X.sa=function(){},X.ra=function(){},X.qa=function(){},X.Ja=function(){},Kr.prototype.a=function(t,e){return new Gr(t,e)},ht(Gr,ge),Gr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;We(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=qr(t,null,t.fa),Ar(t)},Gr.prototype.close=function(){Tr(this.a)},Gr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Dr(this.a,e)}else this.l?((e={}).__data__=we(t),Dr(this.a,e)):Dr(this.a,t)},Gr.prototype.G=function(){this.a.f=null,delete this.f,Tr(this.a),delete this.a,Gr.X.G.call(this)},ht(zr,on),ht(Qr,sn),ht(Hr,Br),Hr.prototype.ta=function(){me(this.a,"a")},Hr.prototype.sa=function(t){me(this.a,new zr(t))},Hr.prototype.ra=function(t){me(this.a,new Qr(t))},Hr.prototype.qa=function(){me(this.a,"b")},Kr.prototype.createWebChannel=Kr.prototype.a,Gr.prototype.send=Gr.prototype.h,Gr.prototype.open=Gr.prototype.g,Gr.prototype.close=Gr.prototype.close,Je.NO_ERROR=0,Je.TIMEOUT=8,Je.HTTP_ERROR=6,$e.COMPLETE="complete",en.EventType=rn,rn.OPEN="a",rn.CLOSE="b",rn.ERROR="c",rn.MESSAGE="d",ge.prototype.listen=ge.prototype.va,cr.prototype.listenOnce=cr.prototype.wa,cr.prototype.getLastError=cr.prototype.Qa,cr.prototype.getLastErrorCode=cr.prototype.ua,cr.prototype.getStatus=cr.prototype.W,cr.prototype.getResponseJson=cr.prototype.Pa,cr.prototype.getResponseText=cr.prototype.$,cr.prototype.send=cr.prototype.ba;var Wr=Je,Yr=$e,Xr=Be,Jr=10,$r=11,Zr=en,ti=cr,ei=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();ei.o=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ni=new O("@firebase/firestore");function ri(){return ni.logLevel}function ii(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ni.logLevel<=_.DEBUG){var r=e.map(ai);ni.debug.apply(ni,s(["Firestore (8.3.1): "+t],r))}}function oi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ni.logLevel<=_.ERROR){var r=e.map(ai);ni.error.apply(ni,s(["Firestore (8.3.1): "+t],r))}}function si(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ni.logLevel<=_.WARN){var r=e.map(ai);ni.warn.apply(ni,s(["Firestore (8.3.1): "+t],r))}}function ai(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(n){return t}
/**
  * @license
  * Copyright 2020 Google LLC
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
  * You may obtain a copy of the License at
  *
  *   http://www.apache.org/licenses/LICENSE-2.0
  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an "AS IS" BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ui(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.3.1) INTERNAL ASSERTION FAILED: "+t;throw oi(e),new Error(e)}function ci(t,e){t||ui()}function hi(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function li(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fi=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=li(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function pi(t,e){return t<e?-1:t>e?1:0}function di(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function yi(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vi(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function gi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function mi(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bi(t){return null==t}function wi(t){return 0===t&&1/t==-1/0}function Ei(t){return"number"==typeof t&&Number.isInteger(t)&&!wi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ii={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Ti=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return e(n,t),n}(Error),_i=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&ui(),void 0===n?n=t.length-e:n>t.length-e&&ui(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Si=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.prototype.canonicalString=function(){return this.toArray().join("/")},n.prototype.toString=function(){return this.canonicalString()},n.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new n(r)},n.emptyPath=function(){return new n([])},n}(_i),Di=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ai=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.isValidIdentifier=function(t){return Di.test(t)},n.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.canonicalString()},n.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},n.keyField=function(){return new n(["__name__"])},n.fromServerFormat=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Ti(Ii.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Ti(Ii.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Ti(Ii.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.emptyPath=function(){return new n([])},n}(_i),Ni=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Si.fromString(e))},t.fromName=function(e){return new t(Si.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Si.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Si.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Si(e.slice()))},t}(),Ci=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return pi(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Ci.EMPTY_BYTE_STRING=new Ci("");var ki=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xi(t){if(ci(!!t),"string"==typeof t){var e=0,n=ki.exec(t);if(ci(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Oi(t.seconds),nanos:Oi(t.nanos)}}function Oi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Li(t){return"string"==typeof t?Ci.fromBase64String(t):Ci.fromUint8Array(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ri=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ti(Ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ti(Ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ti(Ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ti(Ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?pi(this.nanoseconds,t.nanoseconds):pi(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Mi(t){var e=t.mapValue.fields.__previous_value__;return Pi(e)?Mi(e):e}function Fi(t){var e=xi(t.mapValue.fields.__local_write_time__.timestampValue);return new Ri(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Pi(t)?4:10:ui()}function Ui(t,e){var n,r=Vi(t);if(r!==Vi(e))return!1;switch(r){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Fi(t).isEqual(Fi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=xi(t.timestampValue),r=xi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return n=e,Li(t.bytesValue).isEqual(Li(n.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Oi(t.geoPointValue.latitude)===Oi(e.geoPointValue.latitude)&&Oi(t.geoPointValue.longitude)===Oi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Oi(t.integerValue)===Oi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Oi(t.doubleValue),r=Oi(e.doubleValue);return n===r?wi(n)===wi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return di(t.arrayValue.values||[],e.arrayValue.values||[],Ui);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(vi(n)!==vi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ui(n[i],r[i])))return!1;return!0}(t,e);default:return ui()}}function qi(t,e){return void 0!==(t.values||[]).find((function(t){return Ui(t,e)}))}function ji(t,e){var n,r,i,o,s=Vi(t),a=Vi(e);if(s!==a)return pi(s,a);switch(s){case 0:return 0;case 1:return pi(t.booleanValue,e.booleanValue);case 2:return r=e,i=Oi((n=t).integerValue||n.doubleValue),o=Oi(r.integerValue||r.doubleValue),i<o?-1:i>o?1:i===o?0:isNaN(i)?isNaN(o)?0:-1:1;case 3:return Bi(t.timestampValue,e.timestampValue);case 4:return Bi(Fi(t),Fi(e));case 5:return pi(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Li(t),r=Li(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=pi(n[i],r[i]);if(0!==o)return o}return pi(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=pi(Oi(t.latitude),Oi(e.latitude));return 0!==n?n:pi(Oi(t.longitude),Oi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ji(n[i],r[i]);if(o)return o}return pi(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=pi(r[s],o[s]);if(0!==a)return a;var u=ji(n[r[s]],i[o[s]]);if(0!==u)return u}return pi(r.length,o.length)}(t.mapValue,e.mapValue);default:throw ui()}}function Bi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return pi(t,e);var n=xi(t),r=xi(e),i=pi(n.seconds,r.seconds);return 0!==i?i:pi(n.nanos,r.nanos)}function Ki(t){return Gi(t)}function Gi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(e=t.timestampValue,"time("+(n=xi(e)).seconds+","+n.nanos+")"):"stringValue"in t?t.stringValue:"bytesValue"in t?Li(t.bytesValue).toBase64():"referenceValue"in t?(i=t.referenceValue,Ni.fromName(i).toString()):"geoPointValue"in t?"geo("+(r=t.geoPointValue).latitude+","+r.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Gi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Gi(t.fields[o])}return e+"}"}(t.mapValue):ui();var e,n,r,i}function zi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Qi(t){return!!t&&"integerValue"in t}function Hi(t){return!!t&&"arrayValue"in t}function Wi(t){return!!t&&"nullValue"in t}function Yi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Xi(t){return!!t&&"mapValue"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ji=function(t,e){this.key=t,this.version=e},$i=function(t){function n(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).objectValue=r,o.hasLocalMutations=!!i.hasLocalMutations,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return e(n,t),n.prototype.field=function(t){return this.objectValue.field(t)},n.prototype.data=function(){return this.objectValue},n.prototype.toProto=function(){return this.objectValue.proto},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.objectValue.isEqual(t.objectValue)},n.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),n}(Ji),Zi=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return e(n,t),n.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(Ji),to=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(Ji),eo=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function no(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new eo(t,e,n,r,i,o,s)}function ro(t){var e=hi(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return(e=t).field.canonicalString()+e.op.toString()+Ki(e.value);var e})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.canonicalString()+e.dir;var e})).join(","),bi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=go(e.startAt)),e.endAt&&(n+="|ub:",n+=go(e.endAt)),e.h=n}return e.h}function io(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!bo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Ui(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Eo(t.startAt,e.startAt)&&Eo(t.endAt,e.endAt)}function oo(t){return Ni.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var so=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return e(n,t),n.create=function(t,e,r){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,r):new ao(t,e,r):"array-contains"===e?new lo(t,r):"in"===e?new fo(t,r):"not-in"===e?new po(t,r):"array-contains-any"===e?new yo(t,r):new n(t,e,r)},n.l=function(t,e,n){return"in"===e?new uo(t,n):new co(t,n)},n.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.m(ji(e,this.value)):null!==e&&Vi(this.value)===Vi(e)&&this.m(ji(e,this.value))},n.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ui()}},n.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}((function(){})),ao=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Ni.fromName(r.referenceValue),i}return e(n,t),n.prototype.matches=function(t){var e=Ni.comparator(t.key,this.key);return this.m(e)},n}(so),uo=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=ho("in",n),r}return e(n,t),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(so),co=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=ho("not-in",n),r}return e(n,t),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(so);function ho(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Ni.fromName(t.referenceValue)}))}var lo=function(t){function n(e,n){return t.call(this,e,"array-contains",n)||this}return e(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return Hi(e)&&qi(e.arrayValue,this.value)},n}(so),fo=function(t){function n(e,n){return t.call(this,e,"in",n)||this}return e(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&qi(this.value.arrayValue,e)},n}(so),po=function(t){function n(e,n){return t.call(this,e,"not-in",n)||this}return e(n,t),n.prototype.matches=function(t){if(qi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!qi(this.value.arrayValue,e)},n}(so),yo=function(t){function n(e,n){return t.call(this,e,"array-contains-any",n)||this}return e(n,t),n.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Hi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return qi(e.value.arrayValue,t)}))},n}(so),vo=function(t,e){this.position=t,this.before=e};function go(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Ki(t)})).join(",")}var mo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function bo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function wo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ni.comparator(Ni.fromName(s.referenceValue),n.key):ji(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Eo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ui(t.position[n],e.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Io=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function To(t,e,n,r,i,o,s,a){return new Io(t,e,n,r,i,o,s,a)}function _o(t){return new Io(t)}function So(t){return!bi(t.limit)&&"F"===t.limitType}function Do(t){return!bi(t.limit)&&"L"===t.limitType}function Ao(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function No(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Co(t){return null!==t.collectionGroup}function ko(t){var e=hi(t);if(null===e.p){e.p=[];var n=No(e),r=Ao(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new mo(n)),e.p.push(new mo(Ai.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new mo(Ai.keyField(),u))}}}return e.p}function xo(t){var e=hi(t);if(!e.T)if("F"===e.limitType)e.T=no(e.path,e.collectionGroup,ko(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ko(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new mo(o.field,s))}var a=e.endAt?new vo(e.endAt.position,!e.endAt.before):null,u=e.startAt?new vo(e.startAt.position,!e.startAt.before):null;e.T=no(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Oo(t,e,n){return new Io(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Lo(t,e){return io(xo(t),xo(e))&&t.limitType===e.limitType}function Ro(t){return ro(xo(t))+"|lt:"+t.limitType}function Po(t){return"Query(target="+(e=xo(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=", filters: ["+e.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Ki(e.value);var e})).join(", ")+"]"),bi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(e=t).field.canonicalString()+" ("+e.dir+")";var e})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+go(e.startAt)),e.endAt&&(n+=", endAt: "+go(e.endAt)),"Target("+n+"); limitType=")+t.limitType+")";var e,n}function Mo(t,e){return n=t,i=(r=e).key.path,(null!==n.collectionGroup?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):Ni.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i))&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!wo(t.startAt,ko(t),e)||t.endAt&&wo(t.endAt,ko(t),e))}(t,e);var n,r,i}function Fo(t){return function(e,n){for(var r=!1,i=0,o=ko(t);i<o.length;i++){var s=o[i],a=Vo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Vo(t,e,n){var r,i,o,s,a=t.field.isKeyField()?Ni.comparator(e.key,n.key):(r=t.field,i=n,o=e.field(r),s=i.field(r),null!==o&&null!==s?ji(o,s):ui());switch(t.dir){case"asc":return a;case"desc":return-1*a;default:return ui()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Uo=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Ri(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}(),qo=function(){function t(t){this.fields=t,t.sort(Ai.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return di(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),jo=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Xi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.isEqual=function(t){return Ui(this.proto,t.proto)},t}(),Bo=function(){function t(t){void 0===t&&(t=jo.empty()),this.I=t,this.A=new Map}return t.prototype.set=function(t,e){return this.R(t,e),this},t.prototype.delete=function(t){return this.R(t,null),this},t.prototype.R=function(t,e){for(var n=this.A,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Vi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.v=function(){var t=this.P(Ai.emptyPath(),this.A);return null!=t?new jo(t):this.I},t.prototype.P=function(t,e){var n=this,r=!1,i=this.I.field(t),o=Xi(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.P(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(t){var e=[];return gi(t.fields||{},(function(t,n){var r=new Ai([t]);if(Xi(n)){var i=Ko(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new qo(e)}function Go(t,e){if(t.V){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wi(e)?"-0":e}}function zo(t){return{integerValue:""+t}}function Qo(t,e){return Ei(e)?zo(e):Go(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ho=function(){this._=void 0};function Wo(t,e,n){return t instanceof Jo?(i=e,o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(r=n).seconds,nanos:r.nanoseconds}}}},i&&(o.fields.__previous_value__=i),{mapValue:o}):t instanceof $o?Zo(t,e):t instanceof ts?es(t,e):function(t,e){var n=Xo(t,e),r=rs(n)+rs(t.S);return Qi(n)&&Qi(t.S)?zo(r):Go(t.D,r)}(t,e);var r,i,o}function Yo(t,e,n){return t instanceof $o?Zo(t,e):t instanceof ts?es(t,e):n}function Xo(t,e){return t instanceof ns?Qi(r=e)||(n=r)&&"doubleValue"in n?e:{integerValue:0}:null;var n,r}var Jo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(Ho),$o=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return e(n,t),n}(Ho);function Zo(t,e){for(var n=is(e),r=function(t){n.some((function(e){return Ui(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ts=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return e(n,t),n}(Ho);function es(t,e){for(var n=is(e),r=function(t){n=n.filter((function(e){return!Ui(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ns=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).D=e,r.S=n,r}return e(n,t),n}(Ho);function rs(t){return Oi(t.integerValue||t.doubleValue)}function is(t){return Hi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var os=function(t,e){this.field=t,this.transform=e},ss=function(t,e){this.version=t,this.transformResults=e},as=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function us(t,e){return void 0!==t.updateTime?e instanceof $i&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof $i}var cs=function(){};function hs(t,e,n){return t instanceof ys?(i=e,o=n,s=(r=t).value,a=ms(r.fieldTransforms,i,o.transformResults),s=ws(r.fieldTransforms,s,a),new $i(r.key,o.version,s,{hasCommittedMutations:!0})):t instanceof vs?function(t,e,n){if(!us(t.precondition,e))return new to(t.key,n.version);var r=gs(t,e,ms(t.fieldTransforms,e,n.transformResults));return new $i(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new Zi(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n);var r,i,o,s,a}function ls(t,e,n){return t instanceof ys?function(t,e,n){if(!us(t.precondition,e))return e;var r=t.value,i=bs(t.fieldTransforms,n,e);r=ws(t.fieldTransforms,r,i);var o=ds(e);return new $i(t.key,o,r,{hasLocalMutations:!0})}(t,e,n):t instanceof vs?function(t,e,n){if(!us(t.precondition,e))return e;var r=ds(e),i=gs(t,e,bs(t.fieldTransforms,n,e));return new $i(t.key,r,i,{hasLocalMutations:!0})}(t,e,n):(i=e,us((r=t).precondition,i)?new Zi(r.key,Uo.min()):i);var r,i}function fs(t,e){return function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof $i?e.field(o.field):void 0,a=Xo(o.transform,s||null);null!=a&&(n=null==n?(new Bo).set(o.field,a):n.set(o.field,a))}return n?n.v():null}(t.fieldTransforms,e)}function ps(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&di(n,r,(function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof $o&&o instanceof $o||i instanceof ts&&o instanceof ts?di(i.elements,o.elements,Ui):i instanceof ns&&o instanceof ns?Ui(i.S,o.S):i instanceof Jo&&o instanceof Jo);var n,r,i,o}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function ds(t){return t instanceof $i?t.version:Uo.min()}var ys=function(t){function n(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return e(n,t),n}(cs),vs=function(t){function n(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return e(n,t),n}(cs);function gs(t,e,n){var r,i,o,s;return i=t,o=r=e instanceof $i?e.data():jo.empty(),s=new Bo(o),i.fieldMask.fields.forEach((function(t){if(!t.isEmpty()){var e=i.data.field(t);null!==e?s.set(t,e):s.delete(t)}})),r=s.v(),ws(t.fieldTransforms,r,n)}function ms(t,e,n){var r=[];ci(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=null;e instanceof $i&&(a=e.field(o.field)),r.push(Yo(s,a,n[i]))}return r}function bs(t,e,n){for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=null;n instanceof $i&&(u=n.field(s.field)),r.push(Wo(a,u,e))}return r}function ws(t,e,n){for(var r=new Bo(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.v()}var Es,Is,Ts=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return e(n,t),n}(cs),_s=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return e(n,t),n}(cs),Ss=function(t){this.count=t};function Ds(t){switch(t){case Ii.OK:return ui();case Ii.CANCELLED:case Ii.UNKNOWN:case Ii.DEADLINE_EXCEEDED:case Ii.RESOURCE_EXHAUSTED:case Ii.INTERNAL:case Ii.UNAVAILABLE:case Ii.UNAUTHENTICATED:return!1;case Ii.INVALID_ARGUMENT:case Ii.NOT_FOUND:case Ii.ALREADY_EXISTS:case Ii.PERMISSION_DENIED:case Ii.FAILED_PRECONDITION:case Ii.ABORTED:case Ii.OUT_OF_RANGE:case Ii.UNIMPLEMENTED:case Ii.DATA_LOSS:return!0;default:return ui()}}function As(t){if(void 0===t)return oi("GRPC error has no .code"),Ii.UNKNOWN;switch(t){case Es.OK:return Ii.OK;case Es.CANCELLED:return Ii.CANCELLED;case Es.UNKNOWN:return Ii.UNKNOWN;case Es.DEADLINE_EXCEEDED:return Ii.DEADLINE_EXCEEDED;case Es.RESOURCE_EXHAUSTED:return Ii.RESOURCE_EXHAUSTED;case Es.INTERNAL:return Ii.INTERNAL;case Es.UNAVAILABLE:return Ii.UNAVAILABLE;case Es.UNAUTHENTICATED:return Ii.UNAUTHENTICATED;case Es.INVALID_ARGUMENT:return Ii.INVALID_ARGUMENT;case Es.NOT_FOUND:return Ii.NOT_FOUND;case Es.ALREADY_EXISTS:return Ii.ALREADY_EXISTS;case Es.PERMISSION_DENIED:return Ii.PERMISSION_DENIED;case Es.FAILED_PRECONDITION:return Ii.FAILED_PRECONDITION;case Es.ABORTED:return Ii.ABORTED;case Es.OUT_OF_RANGE:return Ii.OUT_OF_RANGE;case Es.UNIMPLEMENTED:return Ii.UNIMPLEMENTED;case Es.DATA_LOSS:return Ii.DATA_LOSS;default:return ui()}}(Is=Es||(Es={}))[Is.OK=0]="OK",Is[Is.CANCELLED=1]="CANCELLED",Is[Is.UNKNOWN=2]="UNKNOWN",Is[Is.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Is[Is.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Is[Is.NOT_FOUND=5]="NOT_FOUND",Is[Is.ALREADY_EXISTS=6]="ALREADY_EXISTS",Is[Is.PERMISSION_DENIED=7]="PERMISSION_DENIED",Is[Is.UNAUTHENTICATED=16]="UNAUTHENTICATED",Is[Is.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Is[Is.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Is[Is.ABORTED=10]="ABORTED",Is[Is.OUT_OF_RANGE=11]="OUT_OF_RANGE",Is[Is.UNIMPLEMENTED=12]="UNIMPLEMENTED",Is[Is.INTERNAL=13]="INTERNAL",Is[Is.UNAVAILABLE=14]="UNAVAILABLE",Is[Is.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ns=function(){function t(t,e){this.comparator=t,this.root=e||ks.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ks.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ks.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Cs(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Cs(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Cs(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Cs(this.root,t,this.comparator,!0)},t}(),Cs=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),ks=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw ui();if(this.right.isRed())throw ui();var t=this.left.check();if(t!==this.right.check())throw ui();return t+(this.isRed()?0:1)},t}();ks.EMPTY=null,ks.RED=!0,ks.BLACK=!1,ks.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw ui()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw ui()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw ui()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw ui()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw ui()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new ks(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var xs=function(){function t(t){this.comparator=t,this.data=new Ns(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Os(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Os(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Os=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Ls=new Ns(Ni.comparator);function Rs(){return Ls}function Ps(){return Rs()}var Ms=new Ns(Ni.comparator);function Fs(){return Ms}var Vs=new Ns(Ni.comparator);var Us=new xs(Ni.comparator);function qs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Us,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var js=new xs(pi);function Bs(){return js}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ks=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Gs.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Uo.min(),r,Bs(),Rs(),qs())},t}(),Gs=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Ci.EMPTY_BYTE_STRING,n,qs(),qs(),qs())},t}(),zs=function(t,e,n,r){this.C=t,this.removedTargetIds=e,this.key=n,this.N=r},Qs=function(t,e){this.targetId=t,this.$=e},Hs=function(t,e,n,r){void 0===n&&(n=Ci.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ws=function(){function t(){this.F=0,this.O=Js(),this.k=Ci.EMPTY_BYTE_STRING,this.M=!1,this.L=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.M},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.k},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"B",{get:function(){return 0!==this.F},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"q",{get:function(){return this.L},enumerable:!1,configurable:!0}),t.prototype.U=function(t){t.approximateByteSize()>0&&(this.L=!0,this.k=t)},t.prototype.K=function(){var t=qs(),e=qs(),n=qs();return this.O.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:ui()}})),new Gs(this.k,this.M,t,e,n)},t.prototype.W=function(){this.L=!1,this.O=Js()},t.prototype.j=function(t,e){this.L=!0,this.O=this.O.insert(t,e)},t.prototype.G=function(t){this.L=!0,this.O=this.O.remove(t)},t.prototype.H=function(){this.F+=1},t.prototype.J=function(){this.F-=1},t.prototype.Y=function(){this.L=!0,this.M=!0},t}(),Ys=function(){function t(t){this.X=t,this.Z=new Map,this.tt=Rs(),this.et=Xs(),this.nt=new xs(pi)}return t.prototype.st=function(t){for(var e=0,n=t.C;e<n.length;e++){var r=n[e];t.N instanceof $i?this.it(r,t.N):t.N instanceof Zi&&this.rt(r,t.key,t.N)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.rt(r,t.key,t.N)},t.prototype.ot=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ct(n);switch(t.state){case 0:e.at(n)&&r.U(t.resumeToken);break;case 1:r.J(),r.B||r.W(),r.U(t.resumeToken);break;case 2:r.J(),r.B||e.removeTarget(n);break;case 3:e.at(n)&&(r.Y(),r.U(t.resumeToken));break;case 4:e.at(n)&&(e.ut(n),r.U(t.resumeToken));break;default:ui()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Z.forEach((function(t,r){n.at(r)&&e(r)}))},t.prototype.ht=function(t){var e=t.targetId,n=t.$.count,r=this.lt(e);if(r){var i=r.target;if(oo(i))if(0===n){var o=new Ni(i.path);this.rt(e,o,new Zi(o,Uo.min()))}else ci(1===n);else this.ft(e)!==n&&(this.ut(e),this.nt=this.nt.add(e))}},t.prototype.dt=function(t){var e=this,n=new Map;this.Z.forEach((function(r,i){var o=e.lt(i);if(o){if(r.current&&oo(o.target)){var s=new Ni(o.target.path);null!==e.tt.get(s)||e.wt(i,s)||e.rt(i,s,new Zi(s,t))}r.q&&(n.set(i,r.K()),r.W())}}));var r=qs();this.et.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.lt(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Ks(t,n,this.nt,this.tt,r);return this.tt=Rs(),this.et=Xs(),this.nt=new xs(pi),i},t.prototype.it=function(t,e){if(this.at(t)){var n=this.wt(t,e.key)?2:0;this.ct(t).j(e.key,n),this.tt=this.tt.insert(e.key,e),this.et=this.et.insert(e.key,this._t(e.key).add(t))}},t.prototype.rt=function(t,e,n){if(this.at(t)){var r=this.ct(t);this.wt(t,e)?r.j(e,1):r.G(e),this.et=this.et.insert(e,this._t(e).delete(t)),n&&(this.tt=this.tt.insert(e,n))}},t.prototype.removeTarget=function(t){this.Z.delete(t)},t.prototype.ft=function(t){var e=this.ct(t).K();return this.X.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.H=function(t){this.ct(t).H()},t.prototype.ct=function(t){var e=this.Z.get(t);return e||(e=new Ws,this.Z.set(t,e)),e},t.prototype._t=function(t){var e=this.et.get(t);return e||(e=new xs(pi),this.et=this.et.insert(t,e)),e},t.prototype.at=function(t){var e=null!==this.lt(t);return e||ii("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.lt=function(t){var e=this.Z.get(t);return e&&e.B?null:this.X.yt(t)},t.prototype.ut=function(t){var e=this;this.Z.set(t,new Ws),this.X.getRemoteKeysForTarget(t).forEach((function(n){e.rt(t,n,null)}))},t.prototype.wt=function(t,e){return this.X.getRemoteKeysForTarget(t).has(e)},t}();function Xs(){return new Ns(Ni.comparator)}function Js(){return new Ns(Ni.comparator)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $s={asc:"ASCENDING",desc:"DESCENDING"},Zs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ta=function(t,e){this.databaseId=t,this.V=e};function ea(t,e){return t.V?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function na(t,e){return t.V?e.toBase64():e.toUint8Array()}function ra(t,e){return ea(t,e.toTimestamp())}function ia(t){return ci(!!t),Uo.fromTimestamp((e=xi(t),new Ri(e.seconds,e.nanos)));var e}function oa(t,e){return(n=t,new Si(["projects",n.projectId,"databases",n.database])).child("documents").child(e).canonicalString();var n}function sa(t){var e=Si.fromString(t);return ci(Ca(e)),e}function aa(t,e){return oa(t.databaseId,e.path)}function ua(t,e){var n=sa(e);if(n.get(1)!==t.databaseId.projectId)throw new Ti(Ii.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ti(Ii.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ni(fa(n))}function ca(t,e){return oa(t.databaseId,e)}function ha(t){var e=sa(t);return 4===e.length?Si.emptyPath():fa(e)}function la(t){return new Si(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function fa(t){return ci(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function pa(t,e,n){return{name:aa(t,e),fields:n.proto.mapValue.fields}}function da(t,e){var n,r,i;if(e instanceof ys)n={update:pa(t,e.key,e.value)};else if(e instanceof Ts)n={delete:aa(t,e.key)};else if(e instanceof vs)n={update:pa(t,e.key,e.data),updateMask:Na(e.fieldMask)};else{if(!(e instanceof _s))return ui();n={verify:aa(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Jo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof $o)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ts)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ns)return{fieldPath:e.field.canonicalString(),increment:n.S};throw ui()}(0,t)}))),e.precondition.isNone||(n.currentDocument=(r=t,void 0!==(i=e.precondition).updateTime?{updateTime:ra(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:ui())),n}function ya(t,e){var n,r=e.currentDocument?void 0!==(n=e.currentDocument).updateTime?as.updateTime(ia(n.updateTime)):void 0!==n.exists?as.exists(n.exists):as.none():as.none(),i=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)ci("REQUEST_TIME"===e.setToServerValue),n=new Jo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new $o(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new ts(i)}else"increment"in e?n=new ns(t,e.increment):ui();var o=Ai.fromServerFormat(e.fieldPath);return new os(o,n)}(t,e)})):[];if(e.update){e.update.name;var o=ua(t,e.update.name),s=new jo({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=function(t){var e=t.fieldPaths||[];return new qo(e.map((function(t){return Ai.fromServerFormat(t)})))}(e.updateMask);return new vs(o,s,a,r,i)}return new ys(o,s,r,i)}if(e.delete){var u=ua(t,e.delete);return new Ts(u,r)}if(e.verify){var c=ua(t,e.verify);return new _s(c,r)}return ui()}function va(t,e){return{documents:[ca(t,e.path)]}}function ga(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ca(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ca(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Yi(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NAN"}};if(Wi(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Yi(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NOT_NAN"}};if(Wi(t.value))return{unaryFilter:{field:_a(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_a(t.field),op:Ta(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:_a((e=t).field),direction:Ia(e.dir)};var e}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,a,u=(s=t,a=e.limit,s.V||bi(a)?a:{value:a});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=wa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=wa(e.endAt)),n}function ma(t){var e=ha(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ci(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=ba(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return new mo(Sa((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var u,c,h=null;n.limit&&(u=n.limit,h=bi(c="object"==typeof u?u.value:u)?null:c);var l=null;n.startAt&&(l=Ea(n.startAt));var f=null;return n.endAt&&(f=Ea(n.endAt)),To(e,i,a,s,h,"F",l,f)}function ba(t){return t?void 0!==t.unaryFilter?[Aa(t)]:void 0!==t.fieldFilter?[Da(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return ba(t)})).reduce((function(t,e){return t.concat(e)})):ui():[]}function wa(t){return{before:t.before,values:t.position}}function Ea(t){var e=!!t.before,n=t.values||[];return new vo(n,e)}function Ia(t){return $s[t]}function Ta(t){return Zs[t]}function _a(t){return{fieldPath:t.canonicalString()}}function Sa(t){return Ai.fromServerFormat(t.fieldPath)}function Da(t){return so.create(Sa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return ui()}}(t.fieldFilter.op),t.fieldFilter.value)}function Aa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Sa(t.unaryFilter.field);return so.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Sa(t.unaryFilter.field);return so.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Sa(t.unaryFilter.field);return so.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Sa(t.unaryFilter.field);return so.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return ui()}}function Na(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Ca(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ka(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Oa(e)),e=xa(t.get(n),e);return Oa(e)}function xa(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Oa(t){return t+""}function La(t){var e=t.length;if(ci(e>=2),2===e)return ci(""===t.charAt(0)&&""===t.charAt(1)),Si.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&ui(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:ui()}o=s+2}return new Si(r)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ra=function(t,e){this.seconds=t,this.nanoseconds=e},Pa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Pa.store="owner",Pa.key="owner";var Ma=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ma.store="mutationQueues",Ma.keyPath="userId";var Fa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Fa.store="mutations",Fa.keyPath="batchId",Fa.userMutationsIndex="userMutationsIndex",Fa.userMutationsKeyPath=["userId","batchId"];var Va=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ka(e)]},t.key=function(t,e,n){return[t,ka(e),n]},t}();Va.store="documentMutations",Va.PLACEHOLDER=new Va;var Ua=function(t,e){this.path=t,this.readTime=e},qa=function(t,e){this.path=t,this.version=e},ja=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ja.store="remoteDocuments",ja.readTimeIndex="readTimeIndex",ja.readTimeIndexPath="readTime",ja.collectionReadTimeIndex="collectionReadTimeIndex",ja.collectionReadTimeIndexPath=["parentPath","readTime"];var Ba=function(t){this.byteSize=t};Ba.store="remoteDocumentGlobal",Ba.key="remoteDocumentGlobalKey";var Ka=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ka.store="targets",Ka.keyPath="targetId",Ka.queryTargetsIndexName="queryTargetsIndex",Ka.queryTargetsKeyPath=["canonicalId","targetId"];var Ga=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ga.store="targetDocuments",Ga.keyPath=["targetId","path"],Ga.documentTargetsIndex="documentTargetsIndex",Ga.documentTargetsKeyPath=["path","targetId"];var za=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};za.key="targetGlobalKey",za.store="targetGlobal";var Qa=function(t,e){this.collectionId=t,this.parent=e};Qa.store="collectionParents",Qa.keyPath=["collectionId","parent"];var Ha=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ha.store="clientMetadata",Ha.keyPath="clientId";var Wa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Wa.store="bundles",Wa.keyPath="bundleId";var Ya=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ya.store="namedQueries",Ya.keyPath="name";var Xa=s(s([],s(s([],s(s([],s(s([],[Ma.store,Fa.store,Va.store,ja.store,Ka.store,Pa.store,za.store,Ga.store]),[Ha.store])),[Ba.store])),[Qa.store])),[Wa.store,Ya.store]),Ja="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$a=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),Za=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},tu=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&ui(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(r){return t.reject(r)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),eu=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.gt=new Za,this.transaction.oncomplete=function(){n.gt.resolve()},this.transaction.onabort=function(){e.error?n.gt.reject(new iu(t,e.error)):n.gt.resolve()},this.transaction.onerror=function(e){var r=cu(e.target.error);n.gt.reject(new iu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(o){throw new iu(n,o)}},Object.defineProperty(t.prototype,"Et",{get:function(){return this.gt.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.gt.reject(t),this.aborted||(ii("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new su(e)},t}(),nu=function(){function t(e,n,r){this.name=e,this.version=n,this.Tt=r,12.2===t.It(c())&&oi("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return ii("SimpleDb","Removing database:",t),au(window.indexedDB.deleteDatabase(t)).toPromise()},t.At=function(){if("undefined"==typeof indexedDB)return!1;if(t.Rt())return!0;var e=c(),n=t.It(e),r=0<n&&n<10,i=t.bt(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.Rt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.vt)},t.Pt=function(t,e){return t.store(e)},t.It=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.bt=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.Vt=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(ii("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new iu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Ti(Ii.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new iu(t,n))},i.onupgradeneeded=function(t){ii("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.Tt.St(e,i.transaction,t.oldVersion,n.version).next((function(){ii("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Dt&&(this.db.onversionchange=function(t){return n.Dt(t)}),this.db)]}}))}))},t.prototype.Ct=function(t){this.Dt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a,u,c;return i(this,(function(h){switch(h.label){case 0:r="readonly"===e,s=0,a=function(){var e,a,c,h,l;return i(this,(function(i){switch(i.label){case 0:++s,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,u.Vt(t)];case 2:return u.db=i.sent(),e=eu.open(u.db,t,r?"readonly":"readwrite",n),a=o(e).catch((function(t){return e.abort(t),tu.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.Et];case 3:return[2,(c.value=(i.sent(),a),c)];case 4:return h=i.sent(),l="FirebaseError"!==h.name&&s<3,ii("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),ru=function(){function t(t){this.xt=t,this.Nt=!1,this.$t=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Nt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ft",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.xt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Nt=!0},t.prototype.Ot=function(t){this.$t=t},t.prototype.delete=function(){return au(this.xt.delete())},t}(),iu=function(t){function n(e,n){var r=this;return(r=t.call(this,Ii.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return e(n,t),n}(Ti);function ou(t){return"IndexedDbTransactionError"===t.name}var su=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(ii("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(ii("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),au(n)},t.prototype.add=function(t){return ii("SimpleDb","ADD",this.store.name,t,t),au(this.store.add(t))},t.prototype.get=function(t){var e=this;return au(this.store.get(t)).next((function(n){return void 0===n&&(n=null),ii("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return ii("SimpleDb","DELETE",this.store.name,t),au(this.store.delete(t))},t.prototype.count=function(){return ii("SimpleDb","COUNT",this.store.name),au(this.store.count())},t.prototype.kt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Mt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Lt=function(t,e){ii("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Bt=!1;var r=this.cursor(n);return this.Mt(r,(function(t,e,n){return n.delete()}))},t.prototype.qt=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Mt(r,e)},t.prototype.Ut=function(t){var e=this.cursor({});return new tu((function(n,r){e.onerror=function(t){var e=cu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.Mt=function(t,e){var n=[];return new tu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ru(i),s=e(i.primaryKey,i.value,o);if(s instanceof tu){var a=s.catch((function(t){return o.done(),tu.reject(t)}));n.push(a)}o.isDone?r():null===o.Ft?i.continue():i.continue(o.Ft)}else r()}})).next((function(){return tu.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Bt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function au(t){return new tu((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=cu(t.target.error);n(e)}}))}var uu=!1;function cu(t){var e=nu.It(c());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Ti("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return uu||(uu=!0,setTimeout((function(){throw r}),0)),r}}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var hu=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Qt=e,r.currentSequenceNumber=n,r}return e(n,t),n}($a);function lu(t,e){var n=hi(t);return nu.Pt(n.Qt,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e,n){for(var r=n.mutationResults,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=hs(o,e,r[i]))}return e},t.prototype.applyToLocalView=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=ls(s,e,this.localWriteTime));for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t)&&(e=ls(s,e,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),qs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&di(this.mutations,t.mutations,(function(t,e){return ps(t,e)}))&&di(this.baseMutations,t.baseMutations,(function(t,e){return ps(t,e)}))},t}(),pu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){ci(e.mutations.length===r.length);for(var i=Vs,o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),du=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Uo.min()),void 0===o&&(o=Uo.min()),void 0===s&&(s=Ci.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),yu=function(t){this.Kt=t};function vu(t,e){if(e.document)return function(t,e,n){var r=ua(t,e.name),i=ia(e.updateTime),o=new jo({mapValue:{fields:e.fields}});return new $i(r,i,o,{hasCommittedMutations:!!n})}(t.Kt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ni.fromSegments(e.noDocument.path),r=Eu(e.noDocument.readTime);return new Zi(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=Ni.fromSegments(e.unknownDocument.path);return r=Eu(e.unknownDocument.version),new to(i,r)}return ui()}function gu(t,e,n){var r,i,o=mu(n),s=e.key.path.popLast().toArray();if(e instanceof $i){var a={name:aa(r=t.Kt,(i=e).key),fields:i.toProto().mapValue.fields,updateTime:ea(r,i.version.toTimestamp())},u=e.hasCommittedMutations;return new ja(null,null,a,u,o,s)}if(e instanceof Zi){var c=e.key.path.toArray(),h=wu(e.version);return u=e.hasCommittedMutations,new ja(null,new Ua(c,h),null,u,o,s)}if(e instanceof to){var l=e.key.path.toArray(),f=wu(e.version);return new ja(new qa(l,f),null,null,!0,o,s)}return ui()}function mu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function bu(t){var e=new Ri(t[0],t[1]);return Uo.fromTimestamp(e)}function wu(t){var e=t.toTimestamp();return new Ra(e.seconds,e.nanoseconds)}function Eu(t){var e=new Ri(t.seconds,t.nanoseconds);return Uo.fromTimestamp(e)}function Iu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return ya(t.Kt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return ya(t.Kt,e)})),a=Ri.fromMillis(e.localWriteTimeMs);return new fu(e.batchId,a,n,s)}function Tu(t){var e,n,r=Eu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Eu(t.lastLimboFreeSnapshotVersion):Uo.min();return void 0!==t.query.documents?(ci(1===(n=t.query).documents.length),e=xo(_o(ha(n.documents[0])))):e=xo(ma(t.query)),new du(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Ci.fromBase64String(t.resumeToken))}function _u(t,e){var n,r=wu(e.snapshotVersion),i=wu(e.lastLimboFreeSnapshotVersion);n=oo(e.target)?va(t.Kt,e.target):ga(t.Kt,e.target);var o=e.resumeToken.toBase64();return new Ka(e.targetId,ro(e.target),r,o,e.sequenceNumber,i,n)}function Su(t){var e=ma({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Oo(e,e.limit,"L"):e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Du=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Au(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Eu(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Au(t).put({bundleId:(n=e).id,createTime:wu(ia(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Nu(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Su(e.bundledQuery),readTime:Eu(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Nu(t).put({name:(n=e).name,readTime:wu(ia(n.readTime)),bundledQuery:n.bundledQuery});var n},t}();function Au(t){return lu(t,Wa.store)}function Nu(t){return lu(t,Ya.store)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cu=function(){function t(){this.Wt=new ku}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Wt.add(e),tu.resolve()},t.prototype.getCollectionParents=function(t,e){return tu.resolve(this.Wt.getEntries(e))},t}(),ku=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new xs(Si.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new xs(Si.comparator)).toArray()},t}(),xu=function(){function t(){this.jt=new ku}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.jt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.jt.add(e)}));var o={collectionId:r,parent:ka(i)};return Ou(t).put(o)}return tu.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[yi(e),""],!1,!0);return Ou(t).kt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(La(o.parent))}return n}))},t}();function Ou(t){return lu(t,Qa.store)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ru=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pu(t,e,n){var r=t.store(Fa.store),i=t.store(Va.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.qt({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){ci(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Va.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return tu.waitFor(o).next((function(){return c}))}function Mu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ui();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ru.DEFAULT_COLLECTION_PERCENTILE=10,Ru.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ru.DEFAULT=new Ru(41943040,Ru.DEFAULT_COLLECTION_PERCENTILE,Ru.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ru.DISABLED=new Ru(-1,0,0);var Fu=function(){function t(t,e,n,r){this.userId=t,this.D=e,this.Gt=n,this.referenceDelegate=r,this.zt={}}return t.Ht=function(e,n,r,i){return ci(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Uu(t).qt({index:Fa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=qu(t),s=Uu(t);return s.add({}).next((function(a){ci("number"==typeof a);for(var u=new fu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return da(t.Kt,e)})),i=n.mutations.map((function(e){return da(t.Kt,e)}));return new Fa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.D,i.userId,u),h=[],l=new xs((function(t,e){return pi(t.canonicalString(),e.canonicalString())})),f=0,p=r;f<p.length;f++){var d=p[f],y=Va.key(i.userId,d.key.path,a);l=l.add(d.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Va.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Gt.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.zt[a]=u.keys()})),tu.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Uu(t).get(e).next((function(t){return t?(ci(t.userId===n.userId),Iu(n.D,t)):null}))},t.prototype.Jt=function(t,e){var n=this;return this.zt[e]?tu.resolve(this.zt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.zt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Uu(t).qt({index:Fa.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(ci(e.batchId>=r),o=Iu(n.D,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Uu(t).qt({index:Fa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Uu(t).kt(Fa.userMutationsIndex,n).next((function(t){return t.map((function(t){return Iu(e.D,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Va.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return qu(t).qt({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=La(u);if(a===n.userId&&e.path.isEqual(h))return Uu(t).get(c).next((function(t){if(!t)throw ui();ci(t.userId===n.userId),o.push(Iu(n.D,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new xs(pi),i=[];return e.forEach((function(e){var o=Va.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=qu(t).qt({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=La(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),tu.waitFor(i).next((function(){return n.Yt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Va.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new xs(pi);return qu(t).qt({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=La(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Yt(t,a)}))},t.prototype.Yt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Uu(t).get(e).next((function(t){if(null===t)throw ui();ci(t.userId===n.userId),r.push(Iu(n.D,t))})))})),tu.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Pu(t.Qt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Xt(e.batchId)})),tu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Xt=function(t){delete this.zt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return tu.resolve();var r=IDBKeyRange.lowerBound(Va.prefixForUser(e.userId)),i=[];return qu(t).qt({range:r},(function(t,n,r){if(t[0]===e.userId){var o=La(t[1]);i.push(o)}else r.done()})).next((function(){ci(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Vu(t,this.userId,e)},t.prototype.Zt=function(t){var e=this;return ju(t).get(this.userId).next((function(t){return t||new Ma(e.userId,-1,"")}))},t}();function Vu(t,e,n){var r=Va.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return qu(t).qt({range:o,Bt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Uu(t){return lu(t,Fa.store)}function qu(t){return lu(t,Va.store)}function ju(t){return lu(t,Ma.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bu=function(){function t(t){this.te=t}return t.prototype.next=function(){return this.te+=2,this.te},t.ee=function(){return new t(0)},t.ne=function(){return new t(-1)},t}(),Ku=function(){function t(t,e){this.referenceDelegate=t,this.D=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.se(t).next((function(n){var r=new Bu(n.highestTargetId);return n.highestTargetId=r.next(),e.ie(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.se(t).next((function(t){return Uo.fromTimestamp(new Ri(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.se(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.se(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.ie(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.re(t,e).next((function(){return n.se(t).next((function(r){return r.targetCount+=1,n.oe(e,r),n.ie(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.re(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Gu(t).delete(e.targetId)})).next((function(){return n.se(t)})).next((function(e){return ci(e.targetCount>0),e.targetCount-=1,n.ie(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Gu(t).qt((function(s,a){var u=Tu(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return tu.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return Gu(t).qt((function(t,n){var r=Tu(n);e(r)}))},t.prototype.se=function(t){return zu(t).get(za.key).next((function(t){return ci(null!==t),t}))},t.prototype.ie=function(t,e){return zu(t).put(za.key,e)},t.prototype.re=function(t,e){return Gu(t).put(_u(this.D,e))},t.prototype.oe=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.se(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=ro(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Gu(t).qt({range:r,index:Ka.queryTargetsIndexName},(function(t,n,r){var o=Tu(n);io(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Qu(t);return e.forEach((function(e){var s=ka(e.path);i.push(o.put(new Ga(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),tu.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Qu(t);return tu.forEach(e,(function(e){var o=ka(e.path);return tu.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Qu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Qu(t),i=qs();return r.qt({range:n,Bt:!0},(function(t,e,n){var r=La(t[1]),o=new Ni(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=ka(e.path),r=IDBKeyRange.bound([n],[yi(n)],!1,!0),i=0;return Qu(t).qt({index:Ga.documentTargetsIndex,Bt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.yt=function(t,e){return Gu(t).get(e).next((function(t){return t?Tu(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(t){return lu(t,Ka.store)}function zu(t){return lu(t,za.store)}function Qu(t){return lu(t,Ga.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hu(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){if(t.code!==Ii.FAILED_PRECONDITION||t.message!==Ja)throw t;return ii("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=pi(n,i);return 0===s?pi(r,o):s}var Yu=function(){function t(t){this.ce=t,this.buffer=new xs(Wu),this.ae=0}return t.prototype.ue=function(){return++this.ae},t.prototype.he=function(t){var e=[t,this.ue()];if(this.buffer.size<this.ce)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Wu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Xu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.le=!1,this.fe=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.de(t)},t.prototype.stop=function(){this.fe&&(this.fe.cancel(),this.fe=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.fe},enumerable:!1,configurable:!0}),t.prototype.de=function(t){var e=this,n=this.le?3e5:6e4;ii("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.fe=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:this.fe=null,this.le=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ou(e=n.sent())?(ii("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Hu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.de(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Ju=function(){function t(t,e){this.we=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.we._e(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return tu.resolve(ei.o);var r=new Yu(e);return this.we.forEachTarget(t,(function(t){return r.he(t.sequenceNumber)})).next((function(){return n.we.me(t,(function(t){return r.he(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.we.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.we.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(ii("LruGarbageCollector","Garbage collection skipped; disabled"),tu.resolve(Lu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(ii("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Lu):n.ye(t,e)}))},t.prototype.getCacheSize=function(t){return this.we.getCacheSize(t)},t.prototype.ye=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(ii("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),ri()<=_.DEBUG&&ii("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),tu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),$u=function(){function t(t,e){this.db=t,this.garbageCollector=new Ju(this,e)}return t.prototype._e=function(t){var e=this.ge(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.ge=function(t){var e=0;return this.me(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.me=function(t,e){return this.pe(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return Zu(t,n)},t.prototype.removeReference=function(t,e,n){return Zu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Zu(t,e)},t.prototype.Ee=function(t,e){return r=e,i=!1,ju(n=t).Ut((function(t){return Vu(n,t,r).next((function(t){return t&&(i=!0),tu.resolve(!t)}))})).next((function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.pe(t,(function(s,a){if(a<=e){var u=n.Ee(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Qu(t).delete([0,ka(s.path)])}))}));i.push(u)}})).next((function(){return tu.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Zu(t,e)},t.prototype.pe=function(t,e){var n,r=Qu(t),i=ei.o;return r.qt({index:Ga.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==ei.o&&e(new Ni(La(n)),i),i=a,n=s):i=ei.o})).next((function(){i!==ei.o&&e(new Ni(La(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Zu(t,e){return Qu(t).put((n=e,r=t.currentSequenceNumber,new Ga(0,ka(n.path),r)));var n,r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tc=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){gi(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return mi(this.inner)},t}(),ec=function(){function t(){this.changes=new tc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Uo.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{maybeDocument:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{maybeDocument:null,readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?tu.resolve(n.maybeDocument):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),nc=function(){function t(t,e){this.D=t,this.Gt=e}return t.prototype.addEntry=function(t,e,n){return oc(t).put(sc(e),n)},t.prototype.removeEntry=function(t,e){var n=oc(t),r=sc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Te(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return oc(t).get(sc(e)).next((function(t){return n.Ie(t)}))},t.prototype.Ae=function(t,e){var n=this;return oc(t).get(sc(e)).next((function(t){var e=n.Ie(t);return e?{maybeDocument:e,size:Mu(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Ps();return this.Re(t,e,(function(t,e){var i=n.Ie(e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.be=function(t,e){var n=this,r=Ps(),i=new Ns(Ni.comparator);return this.Re(t,e,(function(t,e){var o=n.Ie(e);o?(r=r.insert(t,o),i=i.insert(t,Mu(e))):(r=r.insert(t,null),i=i.insert(t,0))})).next((function(){return{ve:r,Pe:i}}))},t.prototype.Re=function(t,e,n){if(e.isEmpty())return tu.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return oc(t).qt({range:r},(function(t,e,r){for(var s=Ni.fromSegments(t);o&&Ni.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ot(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Fs(),o=e.path.length+1,s={};if(n.isEqual(Uo.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=mu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ja.collectionReadTimeIndex}return oc(t).qt(s,(function(t,n,s){if(t.length===o){var a=vu(r.D,n);e.path.isPrefixOf(a.key.path)?a instanceof $i&&Mo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new rc(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return ic(t).get(Ba.key).next((function(t){return ci(!!t),t}))},t.prototype.Te=function(t,e){return ic(t).put(Ba.key,e)},t.prototype.Ie=function(t){if(t){var e=vu(this.D,t);return e instanceof Zi&&e.version.isEqual(Uo.min())?null:e}return null},t}(),rc=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Ve=e,r.trackRemovals=n,r.Se=new tc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return e(n,t),n.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new xs((function(t,e){return pi(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Se.get(o);if(s.maybeDocument){var u=gu(e.Ve.D,s.maybeDocument,e.getReadTime(o));i=i.add(o.path.popLast());var c=Mu(u);r+=c-a,n.push(e.Ve.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=gu(e.Ve.D,new Zi(o,Uo.min()),e.getReadTime(o));n.push(e.Ve.addEntry(t,o,h))}else n.push(e.Ve.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ve.Gt.addToCollectionParentIndex(t,r))})),n.push(this.Ve.updateMetadata(t,r)),tu.waitFor(n)},n.prototype.getFromCache=function(t,e){var n=this;return this.Ve.Ae(t,e).next((function(t){return null===t?(n.Se.set(e,0),null):(n.Se.set(e,t.size),t.maybeDocument)}))},n.prototype.getAllFromCache=function(t,e){var n=this;return this.Ve.be(t,e).next((function(t){var e=t.ve;return t.Pe.forEach((function(t,e){n.Se.set(t,e)})),e}))},n}(ec);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ic(t){return lu(t,Ba.store)}function oc(t){return lu(t,ja.store)}function sc(t){return t.path.toArray()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ac=function(){function t(t){this.D=t}return t.prototype.St=function(t,e,n,r){var i=this;ci(n<r&&n>=0&&r<=11);var o=new eu("createOrUpgrade",e);n<1&&r>=1&&(t.createObjectStore(Pa.store),function(t){t.createObjectStore(Ma.store,{keyPath:Ma.keyPath}),t.createObjectStore(Fa.store,{keyPath:Fa.keyPath,autoIncrement:!0}).createIndex(Fa.userMutationsIndex,Fa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Va.store)}(t),uc(t),function(t){t.createObjectStore(ja.store)}(t));var s=tu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ga.store),t.deleteObjectStore(Ka.store),t.deleteObjectStore(za.store)}(t),uc(t)),s=s.next((function(){return function(t){var e=t.store(za.store),n=new za(0,0,Uo.min().toTimestamp(),0);return e.put(za.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Fa.store).kt().next((function(n){t.deleteObjectStore(Fa.store),t.createObjectStore(Fa.store,{keyPath:Fa.keyPath,autoIncrement:!0}).createIndex(Fa.userMutationsIndex,Fa.userMutationsKeyPath,{unique:!0});var r=e.store(Fa.store),i=n.map((function(t){return r.put(t)}));return tu.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Ha.store,{keyPath:Ha.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.De(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Ba.store)}(t),i.Ce(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.xe(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Ne(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ja.store);e.createIndex(ja.readTimeIndex,ja.readTimeIndexPath,{unique:!1}),e.createIndex(ja.collectionReadTimeIndex,ja.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.$e(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Wa.store,{keyPath:Wa.keyPath})}(t),function(t){t.createObjectStore(Ya.store,{keyPath:Ya.keyPath})}(t)}))),s},t.prototype.Ce=function(t){var e=0;return t.store(ja.store).qt((function(t,n){e+=Mu(n)})).next((function(){var n=new Ba(e);return t.store(Ba.store).put(Ba.key,n)}))},t.prototype.De=function(t){var e=this,n=t.store(Ma.store),r=t.store(Fa.store);return n.kt().next((function(n){return tu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.kt(Fa.userMutationsIndex,i).next((function(r){return tu.forEach(r,(function(r){ci(r.userId===n.userId);var i=Iu(e.D,r);return Pu(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.xe=function(t){var e=t.store(Ga.store),n=t.store(ja.store);return t.store(za.store).get(za.key).next((function(t){var r=[];return n.qt((function(n,i){var o=new Si(n),s=[0,ka(o)];r.push(e.get(s).next((function(n){return n?tu.resolve():(r=o,e.put(new Ga(0,ka(r),t.highestListenSequenceNumber)));var r})))})).next((function(){return tu.waitFor(r)}))}))},t.prototype.Ne=function(t,e){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath});var n=e.store(Qa.store),r=new ku,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ka(i)})}};return e.store(ja.store).qt({Bt:!0},(function(t,e){var n=new Si(t);return i(n.popLast())})).next((function(){return e.store(Va.store).qt({Bt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],La(n));return i(r.popLast())}))}))},t.prototype.$e=function(t){var e=this,n=t.store(Ka.store);return n.qt((function(t,r){var i=Tu(r),o=_u(e.D,i);return n.put(o)}))},t}();function uc(t){t.createObjectStore(Ga.store,{keyPath:Ga.keyPath}).createIndex(Ga.documentTargetsIndex,Ga.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath}).createIndex(Ka.queryTargetsIndexName,Ka.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(za.store)}var cc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",hc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Fe=o,this.window=s,this.document=a,this.Oe=c,this.ke=h,this.Me=null,this.Le=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Be=null,this.inForeground=!1,this.qe=null,this.Ue=null,this.Qe=Number.NEGATIVE_INFINITY,this.Ke=function(t){return Promise.resolve()},!t.At())throw new Ti(Ii.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");var l,f;this.referenceDelegate=new $u(this,i),this.We=n+"main",this.D=new yu(u),this.je=new nu(this.We,11,new ac(this.D)),this.Ge=new Ku(this.referenceDelegate,this.D),this.Gt=new xu,this.ze=(l=this.D,f=this.Gt,new nc(l,f)),this.He=new Du,this.window&&this.window.localStorage?this.Je=this.window.localStorage:(this.Je=null,!1===h&&oi("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.Ye().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Ti(Ii.FAILED_PRECONDITION,cc);return t.Xe(),t.Ze(),t.tn(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.Ge.getHighestSequenceNumber(e)}))})).then((function(e){t.Me=new ei(e,t.Oe)})).then((function(){t.Le=!0})).catch((function(e){return t.je&&t.je.close(),Promise.reject(e)}))},t.prototype.en=function(t){var e=this;return this.Ke=function(n){return r(e,void 0,void 0,(function(){return i(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.je.Ct((function(n){return r(e,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Fe.enqueueAndForget((function(){return r(e,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.started?[4,this.Ye()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.Ye=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return fc(e).put(new Ha(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.nn(e).next((function(e){e||(t.isPrimary=!1,t.Fe.enqueueRetryable((function(){return t.Ke(!1)})))}))})).next((function(){return t.sn(e)})).next((function(n){return t.isPrimary&&!n?t.rn(e).next((function(){return!1})):!!n&&t.on(e).next((function(){return!0}))}))})).catch((function(e){if(ou(e))return ii("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return ii("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Fe.enqueueRetryable((function(){return t.Ke(e)})),t.isPrimary=e}))},t.prototype.nn=function(t){var e=this;return lc(t).get(Pa.key).next((function(t){return tu.resolve(e.cn(t))}))},t.prototype.an=function(t){return fc(t).delete(this.clientId)},t.prototype.un=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o=this;return i(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.hn(this.Qe,18e5)?[3,2]:(this.Qe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=lu(t,Ha.store);return e.kt().next((function(t){var n=o.ln(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return tu.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Je)for(e=0,n=t;e<n.length;e++)r=n[e],this.Je.removeItem(this.fn(r.clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.tn=function(){var t=this;this.Ue=this.Fe.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.Ye().then((function(){return t.un()})).then((function(){return t.tn()}))}))},t.prototype.cn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.sn=function(t){var e=this;return this.ke?tu.resolve(!0):lc(t).get(Pa.key).next((function(n){if(null!==n&&e.hn(n.leaseTimestampMs,5e3)&&!e.dn(n.ownerId)){if(e.cn(n)&&e.networkEnabled)return!0;if(!e.cn(n)){if(!n.allowTabSynchronization)throw new Ti(Ii.FAILED_PRECONDITION,cc);return!1}}return!(!e.networkEnabled||!e.inForeground)||fc(t).kt().next((function(t){return void 0===e.ln(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&ii("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(e){switch(e.label){case 0:return this.Le=!1,this.wn(),this.Ue&&(this.Ue.cancel(),this.Ue=null),this._n(),this.mn(),[4,this.je.runTransaction("shutdown","readwrite",[Pa.store,Ha.store],(function(e){var n=new hu(e,ei.o);return t.rn(n).next((function(){return t.an(n)}))}))];case 1:return e.sent(),this.je.close(),this.yn(),[2]}}))}))},t.prototype.ln=function(t,e){var n=this;return t.filter((function(t){return n.hn(t.updateTimeMs,e)&&!n.dn(t.clientId)}))},t.prototype.gn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return fc(e).kt().next((function(e){return t.ln(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Fu.Ht(t,this.D,this.Gt,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.Ge},t.prototype.getRemoteDocumentCache=function(){return this.ze},t.prototype.getIndexManager=function(){return this.Gt},t.prototype.getBundleCache=function(){return this.He},t.prototype.runTransaction=function(t,e,n){var r=this;ii("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.je.runTransaction(t,o,Xa,(function(o){return i=new hu(o,r.Me?r.Me.next():ei.o),"readwrite-primary"===e?r.nn(i).next((function(t){return!!t||r.sn(i)})).next((function(e){if(!e)throw oi("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Fe.enqueueRetryable((function(){return r.Ke(!1)})),new Ti(Ii.FAILED_PRECONDITION,Ja);return n(i)})).next((function(t){return r.on(i).next((function(){return t}))})):r.pn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.pn=function(t){var e=this;return lc(t).get(Pa.key).next((function(t){if(null!==t&&e.hn(t.leaseTimestampMs,5e3)&&!e.dn(t.ownerId)&&!e.cn(t)&&!(e.ke||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Ti(Ii.FAILED_PRECONDITION,cc)}))},t.prototype.on=function(t){var e=new Pa(this.clientId,this.allowTabSynchronization,Date.now());return lc(t).put(Pa.key,e)},t.At=function(){return nu.At()},t.prototype.rn=function(t){var e=this,n=lc(t);return n.get(Pa.key).next((function(t){return e.cn(t)?(ii("IndexedDbPersistence","Releasing primary lease."),n.delete(Pa.key)):tu.resolve()}))},t.prototype.hn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(oi("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Xe=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=function(){t.Fe.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.Ye()}))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)},t.prototype._n=function(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)},t.prototype.Ze=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Be=function(){e.wn(),e.Fe.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Be))},t.prototype.mn=function(){this.Be&&(this.window.removeEventListener("unload",this.Be),this.Be=null)},t.prototype.dn=function(t){var e;try{var n=null!==(null===(e=this.Je)||void 0===e?void 0:e.getItem(this.fn(t)));return ii("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(r){return oi("IndexedDbPersistence","Failed to get zombied client id.",r),!1}},t.prototype.wn=function(){if(this.Je)try{this.Je.setItem(this.fn(this.clientId),String(Date.now()))}catch(t){oi("Failed to set zombie client id.",t)}},t.prototype.yn=function(){if(this.Je)try{this.Je.removeItem(this.fn(this.clientId))}catch(t){}},t.prototype.fn=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function lc(t){return lu(t,Pa.store)}function fc(t){return lu(t,Ha.store)}function pc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var dc=function(){function t(t,e,n){this.ze=t,this.Tn=e,this.Gt=n}return t.prototype.In=function(t,e){var n=this;return this.Tn.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.An(t,e,r)}))},t.prototype.An=function(t,e,n){return this.ze.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t}))},t.prototype.Rn=function(t,e,n){var r=Ps();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)})),r},t.prototype.bn=function(t,e){var n=this;return this.ze.getEntries(t,e).next((function(e){return n.vn(t,e)}))},t.prototype.vn=function(t,e){var n=this;return this.Tn.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var i=n.Rn(t,e,r),o=Rs();return i.forEach((function(t,e){e||(e=new Zi(t,Uo.min())),o=o.insert(t,e)})),o}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Ni.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Pn(t,e.path):Co(e)?this.Vn(t,e,n):this.Sn(t,e,n);var r},t.prototype.Pn=function(t,e){return this.In(t,new Ni(e)).next((function(t){var e=Fs();return t instanceof $i&&(e=e.insert(t.key,t)),e}))},t.prototype.Vn=function(t,e,n){var r=this,i=e.collectionGroup,o=Fs();return this.Gt.getCollectionParents(t,i).next((function(s){return tu.forEach(s,(function(s){var a,u,c=(a=e,u=s.child(i),new Io(u,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));return r.Sn(t,c,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.Sn=function(t,e,n){var r,i,o=this;return this.ze.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o.Tn.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Dn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=ls(u,r.get(c),o.localWriteTime);r=h instanceof $i?r.insert(c,h):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Mo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Dn=function(t,e,n){for(var r=qs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof vs&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.ze.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof $i&&(c=c.insert(t,e))})),c}))},t}(),yc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.Cn=n,this.xn=r}return t.Nn=function(e,n){for(var r=qs(),i=qs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),vc=function(){function t(){}return t.prototype.$n=function(t){this.Fn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i,o=this;return 0===(i=e).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(Uo.min())?this.On(t,e):this.Fn.bn(t,r).next((function(i){var s=o.kn(e,i);return(So(e)||Do(e))&&o.Mn(e.limitType,s,r,n)?o.On(t,e):(ri()<=_.DEBUG&&ii("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Po(e)),o.Fn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.kn=function(t,e){var n=new xs(Fo(t));return e.forEach((function(e,r){r instanceof $i&&Mo(t,r)&&(n=n.add(r))})),n},t.prototype.Mn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.On=function(t,e){return ri()<=_.DEBUG&&ii("QueryEngine","Using full collection scan to execute query:",Po(e)),this.Fn.getDocumentsMatchingQuery(t,e,Uo.min())},t}(),gc=function(){function t(t,e,n,r){this.persistence=t,this.Ln=e,this.D=r,this.Bn=new Ns(pi),this.qn=new tc((function(t){return ro(t)}),io),this.Un=Uo.min(),this.Tn=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.Ge=t.getTargetCache(),this.Kn=new dc(this.Qn,this.Tn,this.persistence.getIndexManager()),this.He=t.getBundleCache(),this.Ln.$n(this.Kn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Bn)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mc(t,e,n,r){return new gc(t,e,n,r)}function bc(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s;return i(this,(function(i){switch(i.label){case 0:return n=hi(t),r=n.Tn,o=n.Kn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var i;return n.Tn.getAllMutationBatches(t).next((function(s){return i=s,r=n.persistence.getMutationQueue(e),o=new dc(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=qs(),a=0,u=i;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=e;p<d.length;p++){var y=d[p];r.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key)}}return o.bn(t,s).next((function(t){return{Wn:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return s=i.sent(),[2,(n.Tn=r,n.Kn=o,n.Ln.$n(n.Kn),s)]}}))}))}function wc(t,e){var n=hi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,o,s,a,u,c,h=e.batch.keys(),l=n.Qn.newChangeBuffer({trackRemovals:!0});return(r=n,i=t,o=e,s=l,a=o.batch,u=a.keys(),c=tu.resolve(),u.forEach((function(t){c=c.next((function(){return s.getEntry(i,t)})).next((function(e){var n=e,r=o.docVersions.get(t);ci(null!==r),(!n||n.version.compareTo(r)<0)&&(n=a.applyToRemoteDocument(t,n,o))&&s.addEntry(n,o.commitVersion)}))})),c.next((function(){return r.Tn.removeMutationBatch(i,a)}))).next((function(){return l.apply(t)})).next((function(){return n.Tn.performConsistencyCheck(t)})).next((function(){return n.Kn.bn(t,h)}))}))}function Ec(t){var e=hi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.Ge.getLastRemoteSnapshotVersion(t)}))}function Ic(t,e){var n=hi(t),r=e.snapshotVersion,i=n.Bn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.Bn;var s=[];e.targetChanges.forEach((function(e,o){var a,u,c,h=i.get(o);if(h){s.push(n.Ge.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.Ge.addMatchingKeys(t,e.addedDocuments,o)})));var l=e.resumeToken;if(l.approximateByteSize()>0){var f=h.withResumeToken(l,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,f),a=h,c=e,ci((u=f).resumeToken.approximateByteSize()>0),(0===a.resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=3e8||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0)&&s.push(n.Ge.updateTargetData(t,f))}}}));var a=Rs();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(function(t,e,n,r,i){var o=qs();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Rs();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s instanceof Zi&&s.version.isEqual(Uo.min())?(e.removeEntry(n,u),o=o.insert(n,s)):null==a||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):ii("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Uo.min())){var u=n.Ge.getLastRemoteSnapshotVersion(t).next((function(e){return n.Ge.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return tu.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Kn.vn(t,a)}))})).then((function(t){return n.Bn=i,t}))}function Tc(t,e){var n=hi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Tn.getNextMutationBatchAfterBatchId(t,e)}))}function _c(t,e){var n=hi(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.Ge.getTargetData(t,e).next((function(i){return i?(r=i,tu.resolve(r)):n.Ge.allocateTargetId(t).next((function(i){return r=new du(e,i,0,t.currentSequenceNumber),n.Ge.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Bn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Bn=n.Bn.insert(t.targetId,t),n.qn.set(e,t.targetId)),t}))}function Sc(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a;return i(this,(function(i){switch(i.label){case 0:r=hi(t),o=r.Bn.get(e),s=n?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",s,(function(t){return r.persistence.referenceDelegate.removeTarget(t,o)}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!ou(a=i.sent()))throw a;return ii("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Bn=r.Bn.remove(e),r.qn.delete(o.target),[2]}}))}))}function Dc(t,e,n){var r=hi(t),i=Uo.min(),o=qs();return r.persistence.runTransaction("Execute query","readonly",(function(t){return(s=r,a=t,u=xo(e),c=hi(s),h=c.qn.get(u),void 0!==h?tu.resolve(c.Bn.get(h)):c.Ge.getTargetData(a,u)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ge.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Ln.getDocumentsMatchingQuery(t,e,n?i:Uo.min(),n?o:qs())})).next((function(t){return{documents:t,jn:o}}));var s,a,u,c,h}))}function Ac(t,e){var n=hi(t),r=hi(n.Ge),i=n.Bn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.yt(t,e).next((function(t){return t?t.target:null}))}))}function Nc(t){var e=hi(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n=e.Qn,r=t,i=e.Un,o=hi(n),s=Rs(),a=mu(i),u=oc(r),c=IDBKeyRange.lowerBound(a,!0),u.qt({index:ja.readTimeIndex,range:c},(function(t,e){var n=vu(o.D,e);s=s.insert(n.key,n),a=e.readTime})).next((function(){return{En:s,readTime:bu(a)}}));var n,r,i,o,s,a,u,c})).then((function(t){var n=t.En,r=t.readTime;return e.Un=r,n}))}function Cc(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){return[2,(e=hi(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e=oc(t),n=Uo.min(),e.qt({index:ja.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=bu(e.readTime)),r.done()})).next((function(){return n}));var e,n})).then((function(t){e.Un=t}))]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kc=function(){function t(t){this.D=t,this.Jn=new Map,this.Yn=new Map}return t.prototype.getBundleMetadata=function(t,e){return tu.resolve(this.Jn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Jn.set(e.id,{id:(n=e).id,version:n.version,createTime:ia(n.createTime)}),tu.resolve()},t.prototype.getNamedQuery=function(t,e){return tu.resolve(this.Yn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.Yn.set(e.name,{name:(n=e).name,query:Su(n.bundledQuery),readTime:ia(n.readTime)}),tu.resolve();var n},t}(),xc=function(){function t(){this.Xn=new xs(Oc.Zn),this.ts=new xs(Oc.es)}return t.prototype.isEmpty=function(){return this.Xn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Oc(t,e);this.Xn=this.Xn.add(n),this.ts=this.ts.add(n)},t.prototype.ns=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.ss(new Oc(t,e))},t.prototype.rs=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.os=function(t){var e=this,n=new Ni(new Si([])),r=new Oc(n,t),i=new Oc(n,t+1),o=[];return this.ts.forEachInRange([r,i],(function(t){e.ss(t),o.push(t.key)})),o},t.prototype.cs=function(){var t=this;this.Xn.forEach((function(e){return t.ss(e)}))},t.prototype.ss=function(t){this.Xn=this.Xn.delete(t),this.ts=this.ts.delete(t)},t.prototype.us=function(t){var e=new Ni(new Si([])),n=new Oc(e,t),r=new Oc(e,t+1),i=qs();return this.ts.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Oc(t,0),n=this.Xn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Oc=function(){function t(t,e){this.key=t,this.hs=e}return t.Zn=function(t,e){return Ni.comparator(t.key,e.key)||pi(t.hs,e.hs)},t.es=function(t,e){return pi(t.hs,e.hs)||Ni.comparator(t.key,e.key)},t}(),Lc=function(){function t(t,e){this.Gt=t,this.referenceDelegate=e,this.Tn=[],this.ls=1,this.fs=new xs(Oc.Zn)}return t.prototype.checkEmpty=function(t){return tu.resolve(0===this.Tn.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ls;this.ls++,this.Tn.length>0&&this.Tn[this.Tn.length-1];var o=new fu(i,e,n,r);this.Tn.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.fs=this.fs.add(new Oc(u.key,i)),this.Gt.addToCollectionParentIndex(t,u.key.path.popLast())}return tu.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return tu.resolve(this.ds(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.ws(n),i=r<0?0:r;return tu.resolve(this.Tn.length>i?this.Tn[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return tu.resolve(0===this.Tn.length?-1:this.ls-1)},t.prototype.getAllMutationBatches=function(t){return tu.resolve(this.Tn.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Oc(e,0),i=new Oc(e,Number.POSITIVE_INFINITY),o=[];return this.fs.forEachInRange([r,i],(function(t){var e=n.ds(t.hs);o.push(e)})),tu.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new xs(pi);return e.forEach((function(t){var e=new Oc(t,0),i=new Oc(t,Number.POSITIVE_INFINITY);n.fs.forEachInRange([e,i],(function(t){r=r.add(t.hs)}))})),tu.resolve(this._s(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Ni.isDocumentKey(i)||(i=i.child(""));var o=new Oc(new Ni(i),0),s=new xs(pi);return this.fs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.hs)),!0)}),o),tu.resolve(this._s(s))},t.prototype._s=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.ds(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;ci(0===this.ys(e.batchId,"removed")),this.Tn.shift();var r=this.fs;return tu.forEach(e.mutations,(function(i){var o=new Oc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.fs=r}))},t.prototype.Xt=function(t){},t.prototype.containsKey=function(t,e){var n=new Oc(e,0),r=this.fs.firstAfterOrEqual(n);return tu.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this.Tn.length,tu.resolve()},t.prototype.ys=function(t,e){return this.ws(t)},t.prototype.ws=function(t){return 0===this.Tn.length?0:t-this.Tn[0].batchId},t.prototype.ds=function(t){var e=this.ws(t);return e<0||e>=this.Tn.length?null:this.Tn[e]},t}(),Rc=function(){function t(t,e){this.Gt=t,this.gs=e,this.docs=new Ns(Ni.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.gs(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:s,readTime:n}),this.size+=s-o,this.Gt.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return tu.resolve(n?n.maybeDocument:null)},t.prototype.getEntries=function(t,e){var n=this,r=Ps();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),tu.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Fs(),i=new Ni(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||c instanceof $i&&Mo(e,c)&&(r=r.insert(c.key,c))}return tu.resolve(r)},t.prototype.ps=function(t,e){return tu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Pc(this)},t.prototype.getSize=function(t){return tu.resolve(this.size)},t}(),Pc=function(t){function n(e){var n=this;return(n=t.call(this)||this).Ve=e,n}return e(n,t),n.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i&&i.maybeDocument?n.push(e.Ve.addEntry(t,i.maybeDocument,e.getReadTime(r))):e.Ve.removeEntry(r)})),tu.waitFor(n)},n.prototype.getFromCache=function(t,e){return this.Ve.getEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.Ve.getEntries(t,e)},n}(ec),Mc=function(){function t(t){this.persistence=t,this.Es=new tc((function(t){return ro(t)}),io),this.lastRemoteSnapshotVersion=Uo.min(),this.highestTargetId=0,this.Ts=0,this.Is=new xc,this.targetCount=0,this.As=Bu.ee()}return t.prototype.forEachTarget=function(t,e){return this.Es.forEach((function(t,n){return e(n)})),tu.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return tu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return tu.resolve(this.Ts)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.As.next(),tu.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ts&&(this.Ts=e),tu.resolve()},t.prototype.re=function(t){this.Es.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.As=new Bu(e),this.highestTargetId=e),t.sequenceNumber>this.Ts&&(this.Ts=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.re(e),this.targetCount+=1,tu.resolve()},t.prototype.updateTargetData=function(t,e){return this.re(e),tu.resolve()},t.prototype.removeTargetData=function(t,e){return this.Es.delete(e.target),this.Is.os(e.targetId),this.targetCount-=1,tu.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.Es.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.Es.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),tu.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return tu.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.Es.get(e)||null;return tu.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this.Is.ns(e,n),tu.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this.Is.rs(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),tu.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.Is.os(e),tu.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.Is.us(e);return tu.resolve(n)},t.prototype.containsKey=function(t,e){return tu.resolve(this.Is.containsKey(e))},t}(),Fc=function(){function t(t,e){var n,r=this;this.Rs={},this.Me=new ei(0),this.Le=!1,this.Le=!0,this.referenceDelegate=t(this),this.Ge=new Mc(this),this.Gt=new Cu,this.ze=(n=this.Gt,new Rc(n,(function(t){return r.referenceDelegate.bs(t)}))),this.D=new yu(e),this.He=new kc(this.D)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.Le=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Gt},t.prototype.getMutationQueue=function(t){var e=this.Rs[t.toKey()];return e||(e=new Lc(this.Gt,this.referenceDelegate),this.Rs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.Ge},t.prototype.getRemoteDocumentCache=function(){return this.ze},t.prototype.getBundleCache=function(){return this.He},t.prototype.runTransaction=function(t,e,n){var r=this;ii("MemoryPersistence","Starting transaction:",t);var i=new Vc(this.Me.next());return this.referenceDelegate.vs(),n(i).next((function(t){return r.referenceDelegate.Ps(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Vs=function(t,e){return tu.or(Object.values(this.Rs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),Vc=function(t){function n(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return e(n,t),n}($a),Uc=function(){function t(t){this.persistence=t,this.Ss=new xc,this.Ds=null}return t.Cs=function(e){return new t(e)},Object.defineProperty(t.prototype,"xs",{get:function(){if(this.Ds)return this.Ds;throw ui()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.Ss.addReference(n,e),this.xs.delete(n.toString()),tu.resolve()},t.prototype.removeReference=function(t,e,n){return this.Ss.removeReference(n,e),this.xs.add(n.toString()),tu.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.xs.add(e.toString()),tu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.Ss.os(e.targetId).forEach((function(t){return n.xs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.xs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.vs=function(){this.Ds=new Set},t.prototype.Ps=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return tu.forEach(this.xs,(function(r){var i=Ni.fromPath(r);return e.Ns(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Ds=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ns(t,e).next((function(t){t?n.xs.delete(e.toString()):n.xs.add(e.toString())}))},t.prototype.bs=function(t){return 0},t.prototype.Ns=function(t,e){var n=this;return tu.or([function(){return tu.resolve(n.Ss.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Vs(t,e)}])},t}(),qc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jc(t,e){return"firestore_clients_"+t+"_"+e}function Bc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Kc(t,e){return"firestore_targets_"+t+"_"+e}qc.UNAUTHENTICATED=new qc(null),qc.GOOGLE_CREDENTIALS=new qc("google-credentials-uid"),qc.FIRST_PARTY=new qc("first-party-uid");var Gc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.$s=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Ti(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(oi("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),zc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.$s=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Ti(i.error.code,i.error.message)),o?new t(e,i.state,r):(oi("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Qc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.$s=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Bs(),s=0;i&&s<r.activeTargetIds.length;++s)i=Ei(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(oi("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Hc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.$s=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(oi("SharedClientState","Failed to parse online state: "+e),null)},t}(),Wc=function(){function t(){this.activeTargetIds=Bs()}return t.prototype.Os=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.ks=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Fs=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Yc=function(){function t(t,e,n,r,i){this.window=t,this.Fe=e,this.persistenceKey=n,this.Ms=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ls=this.Bs.bind(this),this.qs=new Ns(pi),this.started=!1,this.Us=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=jc(this.persistenceKey,this.Ms),this.Ks="firestore_sequence_number_"+this.persistenceKey,this.qs=this.qs.insert(this.Ms,new Wc),this.Ws=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.js=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Gs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.zs=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Hs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Ls)}return t.At=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,u,c,h,l,f=this;return i(this,(function(i){switch(i.label){case 0:return[4,this.syncEngine.gn()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ms&&(o=this.getItem(jc(this.persistenceKey,r)))&&(s=Qc.$s(r,o))&&(this.qs=this.qs.insert(s.clientId,s));for(this.Js(),(a=this.storage.getItem(this.zs))&&(u=this.Ys(a))&&this.Xs(u),c=0,h=this.Us;c<h.length;c++)l=h[c],this.Bs(l);return this.Us=[],this.window.addEventListener("unload",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ks,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Zs(this.qs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.qs.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.ti(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.ti(t,e,n),this.ei(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Kc(this.persistenceKey,t));if(n){var r=zc.$s(t,n);r&&(e=r.state)}}return this.ni.Os(t),this.Js(),e},t.prototype.removeLocalQueryTarget=function(t){this.ni.ks(t),this.Js()},t.prototype.isLocalQueryTarget=function(t){return this.ni.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Kc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.si(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.ei(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.ii(t)},t.prototype.notifyBundleLoaded=function(){this.ri()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.Ls),this.removeItem(this.Qs),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return ii("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){ii("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){ii("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Bs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(ii("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Qs)return void oi("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fe.enqueueRetryable((function(){return r(e,void 0,void 0,(function(){var t,e,r,o,s,a;return i(this,(function(i){if(this.started){if(null!==n.key)if(this.Ws.test(n.key)){if(null==n.newValue)return t=this.oi(n.key),[2,this.ci(t,null)];if(e=this.ai(n.key,n.newValue))return[2,this.ci(e.clientId,e)]}else if(this.js.test(n.key)){if(null!==n.newValue&&(r=this.ui(n.key,n.newValue)))return[2,this.hi(r)]}else if(this.Gs.test(n.key)){if(null!==n.newValue&&(o=this.li(n.key,n.newValue)))return[2,this.fi(o)]}else if(n.key===this.zs){if(null!==n.newValue&&(s=this.Ys(n.newValue)))return[2,this.Xs(s)]}else if(n.key===this.Ks)(a=function(t){var e=ei.o;if(null!=t)try{var n=JSON.parse(t);ci("number"==typeof n),e=n}catch(r){oi("SharedClientState","Failed to read sequence number from WebStorage",r)}return e}(n.newValue))!==ei.o&&this.sequenceNumberHandler(a);else if(n.key===this.Hs)return[2,this.syncEngine.di()]}else this.Us.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"ni",{get:function(){return this.qs.get(this.Ms)},enumerable:!1,configurable:!0}),t.prototype.Js=function(){this.setItem(this.Qs,this.ni.Fs())},t.prototype.ti=function(t,e,n){var r=new Gc(this.currentUser,t,e,n),i=Bc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Fs())},t.prototype.ei=function(t){var e=Bc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.ii=function(t){var e={clientId:this.Ms,onlineState:t};this.storage.setItem(this.zs,JSON.stringify(e))},t.prototype.si=function(t,e,n){var r=Kc(this.persistenceKey,t),i=new zc(t,e,n);this.setItem(r,i.Fs())},t.prototype.ri=function(){this.setItem(this.Hs,"value-not-used")},t.prototype.oi=function(t){var e=this.Ws.exec(t);return e?e[1]:null},t.prototype.ai=function(t,e){var n=this.oi(t);return Qc.$s(n,e)},t.prototype.ui=function(t,e){var n=this.js.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Gc.$s(new qc(i),r,e)},t.prototype.li=function(t,e){var n=this.Gs.exec(t),r=Number(n[1]);return zc.$s(r,e)},t.prototype.Ys=function(t){return Hc.$s(t)},t.prototype.hi=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.wi(t.batchId,t.state,t.error)]:(ii("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.fi=function(t){return this.syncEngine._i(t.targetId,t.state,t.error)},t.prototype.ci=function(t,e){var n=this,r=e?this.qs.insert(t,e):this.qs.remove(t),i=this.Zs(this.qs),o=this.Zs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.mi(s,a).then((function(){n.qs=r}))},t.prototype.Xs=function(t){this.qs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Zs=function(t){var e=Bs();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),Xc=function(){function t(){this.yi=new Wc,this.gi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.yi.Os(t),this.gi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.gi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.yi.ks(t)},t.prototype.isLocalQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.gi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.yi.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},t.prototype.start=function(){return this.yi=new Wc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Jc=function(){function t(){}return t.prototype.pi=function(t){},t.prototype.shutdown=function(){},t}(),$c=function(){function t(){var t=this;this.Ei=function(){return t.Ti()},this.Ii=function(){return t.Ai()},this.Ri=[],this.bi()}return t.prototype.pi=function(t){this.Ri.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ii)},t.prototype.bi=function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ii)},t.prototype.Ti=function(){ii("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(0)},t.prototype.Ai=function(){ii("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(1)},t.At=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Zc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},th=function(){function t(t){this.vi=t.vi,this.Pi=t.Pi}return t.prototype.Vi=function(t){this.Si=t},t.prototype.Di=function(t){this.Ci=t},t.prototype.onMessage=function(t){this.xi=t},t.prototype.close=function(){this.Pi()},t.prototype.send=function(t){this.vi(t)},t.prototype.Ni=function(){this.Si()},t.prototype.$i=function(t){this.Ci(t)},t.prototype.Fi=function(t){this.xi(t)},t}(),eh=function(t){function n(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return e(n,t),n.prototype.qi=function(t,e,n,r){return new Promise((function(i,o){var s=new ti;s.listenOnce(Yr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Wr.NO_ERROR:var e=s.getResponseJson();ii("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Wr.TIMEOUT:ii("Connection",'RPC "'+t+'" timed out'),o(new Ti(Ii.DEADLINE_EXCEEDED,"Request time out"));break;case Wr.HTTP_ERROR:var n=s.getStatus();if(ii("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=(u=r.status,c=u.toLowerCase().replace(/_/g,"-"),Object.values(Ii).indexOf(c)>=0?c:Ii.UNKNOWN);o(new Ti(a,r.message))}else o(new Ti(Ii.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Ti(Ii.UNAVAILABLE,"Connection failed."));break;default:ui()}}finally{ii("Connection",'RPC "'+t+'" completed.')}var u,c}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},n.prototype.Qi=function(t,e){var n,r,i=[this.Oi,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=new Kr,s=Ge(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Bi(a.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())||"object"==typeof navigator&&"ReactNative"===navigator.product||c().indexOf("Electron/")>=0||((r=c()).indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0)||c().indexOf("MSAppHost/")>=0||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(a.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");ii("Connection","Creating WebChannel: "+u,a);var h=o.createWebChannel(u,a),l=!1,f=!1,p=new th({vi:function(t){f?ii("Connection","Not sending because WebChannel is closed:",t):(l||(ii("Connection","Opening WebChannel transport."),h.open(),l=!0),ii("Connection","WebChannel sending:",t),h.send(t))},Pi:function(){return h.close()}}),d=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(e){setTimeout((function(){throw e}),0)}}))};return d(h,Zr.EventType.OPEN,(function(){f||ii("Connection","WebChannel transport opened.")})),d(h,Zr.EventType.CLOSE,(function(){f||(f=!0,ii("Connection","WebChannel transport closed"),p.$i())})),d(h,Zr.EventType.ERROR,(function(t){f||(f=!0,si("Connection","WebChannel transport errored:",t),p.$i(new Ti(Ii.UNAVAILABLE,"The operation could not be completed")))})),d(h,Zr.EventType.MESSAGE,(function(t){var e;if(!f){var n=t.data[0];ci(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){ii("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Es[t];if(void 0!==e)return As(e)}(o),a=i.message;void 0===s&&(s=Ii.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),f=!0,p.$i(new Ti(s,a)),h.close()}else ii("Connection","WebChannel received:",n),p.Fi(n)}})),d(s,Xr.STAT_EVENT,(function(t){t.stat===Jr?ii("Connection","Detected buffering proxy"):t.stat===$r&&ii("Connection","Detected no buffering proxy")})),setTimeout((function(){p.Ni()}),0),p},n}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Oi=e+"://"+t.host,this.ki="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Mi=function(t,e,n,r){var i=this.Li(t,e);ii("RestConnection","Sending: ",i,n);var o={};return this.Bi(o,r),this.qi(t,i,o,n).then((function(t){return ii("RestConnection","Received: ",t),t}),(function(e){throw si("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Ui=function(t,e,n,r){return this.Mi(t,e,n,r)},t.prototype.Bi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.1",t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.Li=function(t,e){var n=Zc[t];return this.Oi+"/v1/"+e+":"+n},t}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nh(){return"undefined"!=typeof window?window:null}function rh(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ih(t){return new ta(t,!0)}var oh=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Fe=t,this.timerId=e,this.Ki=n,this.Wi=r,this.ji=i,this.Gi=0,this.zi=null,this.Hi=Date.now(),this.reset()}return t.prototype.reset=function(){this.Gi=0},t.prototype.Ji=function(){this.Gi=this.ji},t.prototype.Yi=function(t){var e=this;this.cancel();var n=Math.floor(this.Gi+this.Xi()),r=Math.max(0,Date.now()-this.Hi),i=Math.max(0,n-r);i>0&&ii("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Gi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zi=this.Fe.enqueueAfterDelay(this.timerId,i,(function(){return e.Hi=Date.now(),t()})),this.Gi*=this.Wi,this.Gi<this.Ki&&(this.Gi=this.Ki),this.Gi>this.ji&&(this.Gi=this.ji)},t.prototype.Zi=function(){null!==this.zi&&(this.zi.skipDelay(),this.zi=null)},t.prototype.cancel=function(){null!==this.zi&&(this.zi.cancel(),this.zi=null)},t.prototype.Xi=function(){return(Math.random()-.5)*this.Gi},t}(),sh=function(){function t(t,e,n,r,i,o){this.Fe=t,this.tr=n,this.er=r,this.nr=i,this.listener=o,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new oh(t,e)}return t.prototype.cr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.ar=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.ur()},t.prototype.stop=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.cr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.hr=function(){this.state=0,this.rr.reset()},t.prototype.lr=function(){var t=this;this.ar()&&null===this.ir&&(this.ir=this.Fe.enqueueAfterDelay(this.tr,6e4,(function(){return t.dr()})))},t.prototype.wr=function(t){this._r(),this.stream.send(t)},t.prototype.dr=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return this.ar()?[2,this.close(0)]:[2]}))}))},t.prototype._r=function(){this.ir&&(this.ir.cancel(),this.ir=null)},t.prototype.close=function(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return this._r(),this.rr.cancel(),this.sr++,3!==t?this.rr.reset():e&&e.code===Ii.RESOURCE_EXHAUSTED?(oi(e.toString()),oi("Using maximum backoff delay to prevent overloading the backend."),this.rr.Ji()):e&&e.code===Ii.UNAUTHENTICATED&&this.nr.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Di(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.mr=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.yr(this.sr),n=this.sr;this.nr.getToken().then((function(e){t.sr===n&&t.gr(e)}),(function(n){e((function(){var e=new Ti(Ii.UNKNOWN,"Fetching auth token failed: "+n.message);return t.pr(e)}))}))},t.prototype.gr=function(t){var e=this,n=this.yr(this.sr);this.stream=this.Er(t),this.stream.Vi((function(){n((function(){return e.state=2,e.listener.Vi()}))})),this.stream.Di((function(t){n((function(){return e.pr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.ur=function(){var t=this;this.state=4,this.rr.Yi((function(){return r(t,void 0,void 0,(function(){return i(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.pr=function(t){return ii("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.yr=function(t){var e=this;return function(n){e.Fe.enqueueAndForget((function(){return e.sr===t?n():(ii("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),ah=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).D=i,s}return e(n,t),n.prototype.Er=function(t){return this.er.Qi("Listen",t)},n.prototype.onMessage=function(t){this.rr.reset();var e=function(t,e){var n,r;if("targetChange"in e){e.targetChange;var i="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:ui(),o=e.targetChange.targetIds||[],s=function(t,e){return t.V?(ci(void 0===e||"string"==typeof e),Ci.fromBase64String(e||"")):(ci(void 0===e||e instanceof Uint8Array),Ci.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?Ii.UNKNOWN:As(t.code);return new Ti(e,t.message||"")}(u);n=new Hs(i,o,s,a||null)}else if("documentChange"in e){e.documentChange,(i=e.documentChange).document,i.document.name,i.document.updateTime,o=ua(t,i.document.name),s=ia(i.document.updateTime);var u=new jo({mapValue:{fields:i.document.fields}}),c=(a=new $i(o,s,u,{}),i.targetIds||[]),h=i.removedTargetIds||[];n=new zs(c,h,a.key,a)}else if("documentDelete"in e)e.documentDelete,(i=e.documentDelete).document,o=ua(t,i.document),s=i.readTime?ia(i.readTime):Uo.min(),u=new Zi(o,s),a=i.removedTargetIds||[],n=new zs([],a,u.key,u);else if("documentRemove"in e)e.documentRemove,(i=e.documentRemove).document,o=ua(t,i.document),s=i.removedTargetIds||[],n=new zs([],s,o,null);else{if(!("filter"in e))return ui();e.filter;var l=e.filter;l.targetId,i=l.count||0,o=new Ss(i),s=l.targetId,n=new Qs(s,o)}return n}(this.D,t),n=function(t){if(!("targetChange"in t))return Uo.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Uo.min():e.readTime?ia(e.readTime):Uo.min()}(t);return this.listener.Tr(e,n)},n.prototype.Ir=function(t){var e,n,r,i,o={};o.database=la(this.D),o.addTarget=(e=this.D,i=(n=t).target,(r=oo(i)?{documents:va(e,i)}:{query:ga(e,i)}).targetId=n.targetId,n.resumeToken.approximateByteSize()>0?r.resumeToken=na(e,n.resumeToken):n.snapshotVersion.compareTo(Uo.min())>0&&(r.readTime=ea(e,n.snapshotVersion.toTimestamp())),r);var s=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ui()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.D,t);s&&(o.labels=s),this.wr(o)},n.prototype.Ar=function(t){var e={};e.database=la(this.D),e.removeTarget=t,this.wr(e)},n}(sh),uh=function(t){function n(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).D=i,s.Rr=!1,s}return e(n,t),Object.defineProperty(n.prototype,"br",{get:function(){return this.Rr},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.Rr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},n.prototype.mr=function(){this.Rr&&this.vr([])},n.prototype.Er=function(t){return this.er.Qi("Write",t)},n.prototype.onMessage=function(t){if(ci(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();var e=(r=t.writeResults,i=t.commitTime,r&&r.length>0?(ci(void 0!==i),r.map((function(t){return n=i,(r=(e=t).updateTime?ia(e.updateTime):ia(n)).isEqual(Uo.min())&&(r=ia(n)),new ss(r,e.transformResults||[]);var e,n,r}))):[]),n=ia(t.commitTime);return this.listener.Pr(n,e)}var r,i;return ci(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()},n.prototype.Sr=function(){var t={};t.database=la(this.D),this.wr(t)},n.prototype.vr=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return da(e.D,t)}))};this.wr(n)},n}(sh),ch=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.er=n,i.D=r,i.Dr=!1,i}return e(n,t),n.prototype.Cr=function(){if(this.Dr)throw new Ti(Ii.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.Mi=function(t,e,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.er.Mi(t,e,n,i)})).catch((function(t){throw t.code===Ii.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},n.prototype.Ui=function(t,e,n){var r=this;return this.Cr(),this.credentials.getToken().then((function(i){return r.er.Ui(t,e,n,i)})).catch((function(t){throw t.code===Ii.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},n.prototype.terminate=function(){this.Dr=!1},n}((function(){})),hh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.$r=null,this.Fr=!0}return t.prototype.Or=function(){var t=this;0===this.Nr&&(this.kr("Unknown"),this.$r=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.$r=null,t.Mr("Backend didn't respond within 10 seconds."),t.kr("Offline"),Promise.resolve()})))},t.prototype.Lr=function(t){"Online"===this.state?this.kr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr("Connection failed 1 times. Most recent error: "+t.toString()),this.kr("Offline")))},t.prototype.set=function(t){this.Br(),this.Nr=0,"Online"===t&&(this.Fr=!1),this.kr(t)},t.prototype.kr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Mr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fr?(oi(e),this.Fr=!1):ii("OnlineStateTracker",e)},t.prototype.Br=function(){null!==this.$r&&(this.$r.cancel(),this.$r=null)},t}(),lh=function(t,e,n,o,s){var a=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.qr=[],this.Ur=new Map,this.Qr=new Set,this.Kr=[],this.Wr=s,this.Wr.pi((function(t){n.enqueueAndForget((function(){return r(a,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return wh(this)?(ii("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=hi(t)).Qr.add(4),[4,ph(e)];case 1:return n.sent(),e.jr.set("Unknown"),e.Qr.delete(4),[4,fh(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.jr=new hh(n,o)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fh(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:if(!wh(t))return[3,4];e=0,n=t.Kr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function ph(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:e=0,n=t.Kr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function dh(t,e){var n=hi(t);n.Ur.has(e.targetId)||(n.Ur.set(e.targetId,e),bh(n)?mh(n):Ph(n).ar()&&vh(n,e))}function yh(t,e){var n=hi(t),r=Ph(n);n.Ur.delete(e),r.ar()&&gh(n,e),0===n.Ur.size&&(r.ar()?r.lr():wh(n)&&n.jr.set("Unknown"))}function vh(t,e){t.Gr.H(e.targetId),Ph(t).Ir(e)}function gh(t,e){t.Gr.H(e),Ph(t).Ar(e)}function mh(t){t.Gr=new Ys({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},yt:function(e){return t.Ur.get(e)||null}}),Ph(t).start(),t.jr.Or()}function bh(t){return wh(t)&&!Ph(t).cr()&&t.Ur.size>0}function wh(t){return 0===hi(t).Qr.size}function Eh(t){t.Gr=void 0}function Ih(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.Ur.forEach((function(e,n){vh(t,e)})),[2]}))}))}function Th(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){return Eh(t),bh(t)?(t.jr.Lr(e),mh(t)):t.jr.set("Unknown"),[2]}))}))}function _h(t,e,n){return r(this,void 0,void 0,(function(){var o,s,a;return i(this,(function(u){switch(u.label){case 0:if(t.jr.set("Online"),!(e instanceof Hs&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s;return i(this,(function(i){switch(i.label){case 0:n=e.cause,r=0,o=e.targetIds,i.label=1;case 1:return r<o.length?(s=o[r],t.Ur.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:i.sent(),t.Ur.delete(s),t.Gr.removeTarget(s),i.label=3;case 3:i.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return o=u.sent(),ii("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),[4,Sh(t,o)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof zs?t.Gr.st(e):e instanceof Qs?t.Gr.ht(e):t.Gr.ot(e),n.isEqual(Uo.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,Ec(t.localStore)];case 8:return s=u.sent(),n.compareTo(s)>=0?[4,(c=t,h=n,l=c.Gr.dt(h),l.targetChanges.forEach((function(t,e){if(t.resumeToken.approximateByteSize()>0){var n=c.Ur.get(e);n&&c.Ur.set(e,n.withResumeToken(t.resumeToken,h))}})),l.targetMismatches.forEach((function(t){var e=c.Ur.get(t);if(e){c.Ur.set(t,e.withResumeToken(Ci.EMPTY_BYTE_STRING,e.snapshotVersion)),gh(c,t);var n=new du(e.target,t,1,e.sequenceNumber);vh(c,n)}})),c.remoteSyncer.applyRemoteEvent(l))]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return ii("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,Sh(t,a)];case 12:return u.sent(),[3,13];case 13:return[2]}var c,h,l}))}))}function Sh(t,e,n){return r(this,void 0,void 0,(function(){var o=this;return i(this,(function(s){switch(s.label){case 0:if(!ou(e))throw e;return t.Qr.add(1),[4,ph(t)];case 1:return s.sent(),t.jr.set("Offline"),n||(n=function(){return Ec(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return r(o,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return ii("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Qr.delete(1),[4,fh(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Dh(t,e){return e().catch((function(n){return Sh(t,n,e)}))}function Ah(t){return r(this,void 0,void 0,(function(){var e,n,r,o,s;return i(this,(function(i){switch(i.label){case 0:e=hi(t),n=Mh(e),r=e.qr.length>0?e.qr[e.qr.length-1].batchId:-1,i.label=1;case 1:if(!(wh(a=e)&&a.qr.length<10))return[3,7];i.label=2;case 2:return i.trys.push([2,4,,6]),[4,Tc(e.localStore,r)];case 3:return null===(o=i.sent())?(0===e.qr.length&&n.lr(),[3,7]):(r=o.batchId,function(t,e){t.qr.push(e);var n=Mh(t);n.ar()&&n.br&&n.vr(e.mutations)}(e,o),[3,6]);case 4:return s=i.sent(),[4,Sh(e,s)];case 5:return i.sent(),[3,6];case 6:return[3,1];case 7:return Nh(e)&&Ch(e),[2]}var a}))}))}function Nh(t){return wh(t)&&!Mh(t).cr()&&t.qr.length>0}function Ch(t){Mh(t).start()}function kh(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return Mh(t).Sr(),[2]}))}))}function xh(t){return r(this,void 0,void 0,(function(){var e,n,r,o;return i(this,(function(i){for(e=Mh(t),n=0,r=t.qr;n<r.length;n++)o=r[n],e.vr(o.mutations);return[2]}))}))}function Oh(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return r=t.qr.shift(),o=pu.from(r,e,n),[4,Dh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(o)}))];case 1:return i.sent(),[4,Ah(t)];case 2:return i.sent(),[2]}}))}))}function Lh(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e&&Mh(t).br?[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return Ds(r=e.code)&&r!==Ii.ABORTED?(n=t.qr.shift(),Mh(t).hr(),[4,Dh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Ah(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Nh(t)&&Ch(t),[2]}}))}))}function Rh(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=hi(t),e?(n.Qr.delete(2),[4,fh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Qr.add(2),[4,ph(n)]);case 3:r.sent(),n.jr.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Ph(t){var e,n,o,s,a=this;return t.zr||(t.zr=(e=t.datastore,n=t.asyncQueue,o={Vi:Ih.bind(null,t),Di:Th.bind(null,t),Tr:_h.bind(null,t)},(s=hi(e)).Cr(),new ah(n,s.er,s.credentials,s.D,o)),t.Kr.push((function(e){return r(a,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e?(t.zr.hr(),bh(t)?mh(t):t.jr.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.zr.stop()];case 2:n.sent(),Eh(t),n.label=3;case 3:return[2]}}))}))}))),t.zr}function Mh(t){var e,n,o,s,a=this;return t.Hr||(t.Hr=(e=t.datastore,n=t.asyncQueue,o={Vi:kh.bind(null,t),Di:Lh.bind(null,t),Vr:xh.bind(null,t),Pr:Oh.bind(null,t)},(s=hi(e)).Cr(),new uh(n,s.er,s.credentials,s.D,o)),t.Kr.push((function(e){return r(a,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e?(t.Hr.hr(),[4,Ah(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Hr.stop()];case 3:n.sent(),t.qr.length>0&&(ii("RemoteStore","Stopping write stream with "+t.qr.length+" pending writes"),t.qr=[]),n.label=4;case 4:return[2]}}))}))}))),t.Hr}var Fh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Za,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ti(Ii.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Vh(t,e){if(oi("AsyncQueue",e+": "+t),ou(t))return new Ti(Ii.UNAVAILABLE,e+": "+t);throw t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Uh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ni.comparator(e.key,n.key)}:function(t,e){return Ni.comparator(t.key,e.key)},this.keyedMap=Fs(),this.sortedSet=new Ns(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),qh=function(){function t(){this.Jr=new Ns(Ni.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Jr.get(e);n?0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):ui():this.Jr=this.Jr.insert(e,t)},t.prototype.Yr=function(){var t=[];return this.Jr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),jh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Uh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Lo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Bh=function(){this.Xr=void 0,this.listeners=[]},Kh=function(){this.queries=new tc((function(t){return Ro(t)}),Lo),this.onlineState="Unknown",this.Zr=new Set};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:if(n=hi(t),r=e.query,o=!1,(s=n.queries.get(r))||(o=!0,s=new Bh),!o)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),a=s,[4,n.onListen(r)];case 2:return a.Xr=i.sent(),[3,4];case 3:return u=i.sent(),c=Vh(u,"Initialization of query '"+Po(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,s),s.listeners.push(e),e.eo(n.onlineState),s.Xr&&e.no(s.Xr)&&Wh(n),[2]}}))}))}function zh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a;return i(this,(function(i){return n=hi(t),r=e.query,o=!1,(s=n.queries.get(r))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function Qh(t,e){for(var n=hi(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].no(s)&&(r=!0);u.Xr=s}}r&&Wh(n)}function Hh(t,e,n){var r=hi(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Wh(t){t.Zr.forEach((function(t){t.next()}))}var Yh=function(){function t(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.no=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new jh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.io?this.oo(t)&&(this.so.next(t),o=!0):this.co(t,this.onlineState)&&(this.ao(t),o=!0),this.ro=t,o},t.prototype.onError=function(t){this.so.error(t)},t.prototype.eo=function(t){this.onlineState=t;var e=!1;return this.ro&&!this.io&&this.co(this.ro,t)&&(this.ao(this.ro),e=!0),e},t.prototype.co=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.uo&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.oo=function(t){if(t.docChanges.length>0)return!0;var e=this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.ao=function(t){t=jh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)},t}(),Xh=function(t){this.key=t},Jh=function(t){this.key=t},$h=function(){function t(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=qs(),this.mutatedKeys=qs(),this.po=Fo(t),this.Eo=new Uh(this.po)}return Object.defineProperty(t.prototype,"To",{get:function(){return this._o},enumerable:!1,configurable:!0}),t.prototype.Io=function(t,e){var n=this,r=e?e.Ao:new qh,i=e?e.Eo:this.Eo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=So(this.query)&&i.size===this.query.limit?i.last():null,c=Do(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=e instanceof $i?e:null;l&&(l=Mo(n.query,l)?l:null);var f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data().isEqual(l.data())?f!==p&&(r.track({type:3,doc:l}),d=!0):n.Ro(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.po(l,u)>0||c&&n.po(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),So(this.query)||Do(this.query))for(;s.size>this.query.limit;){var h=So(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{Eo:s,Ao:r,Mn:a,mutatedKeys:o}},t.prototype.Ro=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;var o=t.Ao.Yr();o.sort((function(t,e){return n=t.type,i=e.type,(o=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ui()}})(n)-o(i)||r.po(t.doc,e.doc);var n,i,o})),this.bo(n);var s=e?this.vo():[],a=0===this.yo.size&&this.current?1:0,u=a!==this.mo;return this.mo=a,0!==o.length||u?{snapshot:new jh(this.query,t.Eo,i,o,t.mutatedKeys,0===a,u,!1),Po:s}:{Po:s}},t.prototype.eo=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new qh,mutatedKeys:this.mutatedKeys,Mn:!1},!1)):{Po:[]}},t.prototype.Vo=function(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations},t.prototype.bo=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._o=e._o.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e._o=e._o.delete(t)})),this.current=t.current)},t.prototype.vo=function(){var t=this;if(!this.current)return[];var e=this.yo;this.yo=qs(),this.Eo.forEach((function(e){t.Vo(e.key)&&(t.yo=t.yo.add(e.key))}));var n=[];return e.forEach((function(e){t.yo.has(e)||n.push(new Jh(e))})),this.yo.forEach((function(t){e.has(t)||n.push(new Xh(t))})),n},t.prototype.So=function(t){this._o=t.jn,this.yo=qs();var e=this.Io(t.documents);return this.applyChanges(e,!0)},t.prototype.Do=function(){return jh.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)},t}(),Zh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},tl=function(t){this.key=t,this.Co=!1},el=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.xo={},this.No=new tc((function(t){return Ro(t)}),Lo),this.$o=new Map,this.Fo=new Set,this.Oo=new Ns(Ni.comparator),this.ko=new Map,this.Mo=new xc,this.Lo={},this.Bo=new Map,this.qo=Bu.ne(),this.onlineState="Unknown",this.Uo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Uo},enumerable:!1,configurable:!0}),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return n=xl(t),(s=n.No.get(e))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),o=s.view.Do(),[3,4]):[3,1];case 1:return[4,_c(n.localStore,xo(e))];case 2:return a=i.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),r=a.targetId,[4,rl(n,e,r,"current"===u)];case 3:o=i.sent(),n.isPrimaryClient&&dh(n.remoteStore,a),i.label=4;case 4:return[2,o]}}))}))}function rl(t,e,n,o){return r(this,void 0,void 0,(function(){var s,a,u,c,h,l;return i(this,(function(f){switch(f.label){case 0:return t.Qo=function(e,n,o){return function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a;return i(this,(function(i){switch(i.label){case 0:return(r=e.view.Io(n)).Mn?[4,Dc(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view.Io(n,r)}))]:[3,2];case 1:r=i.sent(),i.label=2;case 2:return s=o&&o.targetChanges.get(e.targetId),a=e.view.applyChanges(r,t.isPrimaryClient,s),[2,(vl(t,e.targetId,a.Po),a.snapshot)]}}))}))}(t,e,n,o)},[4,Dc(t.localStore,e,!0)];case 1:return s=f.sent(),a=new $h(e,s.jn),u=a.Io(s.documents),c=Gs.createSynthesizedTargetChangeForCurrentChange(n,o&&"Offline"!==t.onlineState),h=a.applyChanges(u,t.isPrimaryClient,c),vl(t,n,h.Po),l=new Zh(e,n,a),[2,(t.No.set(e,l),t.$o.has(n)?t.$o.get(n).push(e):t.$o.set(n,[e]),h.snapshot)]}}))}))}function il(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=hi(t),r=n.No.get(e),(o=n.$o.get(r.targetId)).length>1?[2,(n.$o.set(r.targetId,o.filter((function(t){return!Lo(t,e)}))),void n.No.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Sc(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),yh(n.remoteStore,r.targetId),dl(n,r.targetId)})).catch(Hu)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return dl(n,r.targetId),[4,Sc(n.localStore,r.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))}function ol(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a;return i(this,(function(i){switch(i.label){case 0:r=Ol(t),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,(u=r.localStore,c=e,l=hi(u),f=Ri.now(),p=c.reduce((function(t,e){return t.add(e.key)}),qs()),l.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return l.Kn.bn(t,p).next((function(e){h=e;for(var n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=fs(o,h.get(o.key));null!=s&&n.push(new vs(o.key,s,Ko(s.proto.mapValue),as.exists(!0)))}return l.Tn.addMutationBatch(t,f,n,c)}))})).then((function(t){var e=t.applyToLocalDocumentSet(h);return{batchId:t.batchId,changes:e}})))];case 2:return o=i.sent(),r.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.Lo[t.currentUser.toKey()];r||(r=new Ns(pi)),r=r.insert(e,n),t.Lo[t.currentUser.toKey()]=r}(r,o.batchId,n),[4,bl(r,o.changes)];case 3:return i.sent(),[4,Ah(r.remoteStore)];case 4:return i.sent(),[3,6];case 5:return s=i.sent(),a=Vh(s,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}var u,c,h,l,f,p}))}))}function sl(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:n=hi(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Ic(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.ko.get(e);r&&(ci(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Co=!0:t.modifiedDocuments.size>0?ci(r.Co):t.removedDocuments.size>0&&(ci(r.Co),r.Co=!1))})),[4,bl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Hu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function al(t,e,n){var r=hi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.No.forEach((function(t,n){var r=n.view.eo(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=hi(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].eo(e)&&(r=!0)})),r&&Wh(n)}(r.eventManager,e),i.length&&r.xo.Tr(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function ul(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:return(r=hi(t)).sharedClientState.updateQueryState(e,"rejected",n),o=r.ko.get(e),(s=o&&o.key)?(a=(a=new Ns(Ni.comparator)).insert(s,new Zi(s,Uo.min())),u=qs().add(s),c=new Ks(Uo.min(),new Map,new xs(pi),a,u),[4,sl(r,c)]):[3,2];case 1:return i.sent(),r.Oo=r.Oo.remove(s),r.ko.delete(e),ml(r),[3,4];case 2:return[4,Sc(r.localStore,e,!1).then((function(){return dl(r,e,n)})).catch(Hu)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))}function cl(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:n=hi(t),r=e.batch.batchId,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,wc(n.localStore,e)];case 2:return o=i.sent(),pl(n,r,null),fl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,bl(n,o)];case 3:return i.sent(),[3,6];case 4:return[4,Hu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function hl(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:r=hi(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,(s=r.localStore,a=e,u=hi(s),u.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return u.Tn.lookupMutationBatch(t,a).next((function(n){return ci(null!==n),e=n.keys(),u.Tn.removeMutationBatch(t,n)})).next((function(){return u.Tn.performConsistencyCheck(t)})).next((function(){return u.Kn.bn(t,e)}))})))];case 2:return o=i.sent(),pl(r,e,n),fl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,bl(r,o)];case 3:return i.sent(),[3,6];case 4:return[4,Hu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}var s,a,u}))}))}function ll(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a;return i(this,(function(i){switch(i.label){case 0:wh((n=hi(t)).remoteStore)||ii("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(u=n.localStore,c=hi(u),c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return c.Tn.getHighestUnacknowledgedBatchId(t)})))];case 2:return-1===(r=i.sent())?[2,void e.resolve()]:((o=n.Bo.get(r)||[]).push(e),n.Bo.set(r,o),[3,4]);case 3:return s=i.sent(),a=Vh(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}var u,c}))}))}function fl(t,e){(t.Bo.get(e)||[]).forEach((function(t){t.resolve()})),t.Bo.delete(e)}function pl(t,e,n){var r=hi(t),i=r.Lo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Lo[r.currentUser.toKey()]=i}}function dl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.$o.get(e);r<i.length;r++){var o=i[r];t.No.delete(o),n&&t.xo.Ko(o,n)}t.$o.delete(e),t.isPrimaryClient&&t.Mo.os(e).forEach((function(e){t.Mo.containsKey(e)||yl(t,e)}))}function yl(t,e){t.Fo.delete(e.path.canonicalString());var n=t.Oo.get(e);null!==n&&(yh(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.ko.delete(n),ml(t))}function vl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Xh?(t.Mo.addReference(o.key,e),gl(t,o)):o instanceof Jh?(ii("SyncEngine","Document no longer in limbo: "+o.key),t.Mo.removeReference(o.key,e),t.Mo.containsKey(o.key)||yl(t,o.key)):ui()}}function gl(t,e){var n=e.key,r=n.path.canonicalString();t.Oo.get(n)||t.Fo.has(r)||(ii("SyncEngine","New document in limbo: "+n),t.Fo.add(r),ml(t))}function ml(t){for(;t.Fo.size>0&&t.Oo.size<t.maxConcurrentLimboResolutions;){var e=t.Fo.values().next().value;t.Fo.delete(e);var n=new Ni(Si.fromString(e)),r=t.qo.next();t.ko.set(r,new tl(n)),t.Oo=t.Oo.insert(n,r),dh(t.remoteStore,new du(xo(_o(n.path)),r,2,ei.o))}}function bl(t,e,n){return r(this,void 0,void 0,(function(){var o,s,a,u;return i(this,(function(c){switch(c.label){case 0:return o=hi(t),s=[],a=[],u=[],o.No.isEmpty()?[3,3]:(o.No.forEach((function(t,r){u.push(o.Qo(r,e,n).then((function(t){if(t){o.isPrimaryClient&&o.sharedClientState.updateQueryState(r.targetId,t.fromCache?"not-current":"current"),s.push(t);var e=yc.Nn(r.targetId,t);a.push(e)}})))})),[4,Promise.all(u)]);case 1:return c.sent(),o.xo.Tr(s),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l;return i(this,(function(i){switch(i.label){case 0:n=hi(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return tu.forEach(e,(function(e){return tu.forEach(e.Cn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return tu.forEach(e.xn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return i.sent(),[3,4];case 3:if(!ou(r=i.sent()))throw r;return ii("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(o=0,s=e;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=n.Bn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.Bn=n.Bn.insert(u,l));return[2]}}))}))}(o.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function wl(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return(n=hi(t)).currentUser.isEqual(e)?[3,3]:(ii("SyncEngine","User change. New user:",e.toKey()),[4,bc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,(o=n).Bo.forEach((function(t){t.forEach((function(t){t.reject(new Ti(Ii.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.Bo.clear(),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,bl(n,r.Wn)];case 2:i.sent(),i.label=3;case 3:return[2]}var o}))}))}function El(t,e){var n=hi(t),r=n.ko.get(e);if(r&&r.Co)return qs().add(r.key);var i=qs(),o=n.$o.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.No.get(u);i=i.unionWith(c.view.To)}return i}function Il(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return[4,Dc((n=hi(t)).localStore,e.query,!0)];case 1:return r=i.sent(),o=e.view.So(r),[2,(n.isPrimaryClient&&vl(n,e.targetId,o.Po),o)]}}))}))}function Tl(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){return[2,Nc((e=hi(t)).localStore).then((function(t){return bl(e,t)}))]}))}))}function _l(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return[4,(a=(r=hi(t)).localStore,u=e,c=hi(a),h=hi(c.Tn),c.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return h.Jt(t,u).next((function(e){return e?c.Kn.bn(t,e):tu.resolve(null)}))})))];case 1:return null===(s=i.sent())?[3,6]:"pending"!==n?[3,3]:[4,Ah(r.remoteStore)];case 2:return i.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(pl(r,e,o||null),fl(r,e),function(t,e){hi(hi(t).Tn).Xt(e)}(r.localStore,e)):ui(),i.label=4;case 4:return[4,bl(r,s)];case 5:return i.sent(),[3,7];case 6:ii("SyncEngine","Cannot apply mutation batch with id: "+e),i.label=7;case 7:return[2]}var a,u,c,h}))}))}function Sl(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h;return i(this,(function(i){switch(i.label){case 0:return xl(n=hi(t)),Ol(n),!0!==e||!0===n.Uo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Dl(n,r.toArray())]);case 1:return o=i.sent(),n.Uo=!0,[4,Rh(n.remoteStore,!0)];case 2:for(i.sent(),s=0,a=o;s<a.length;s++)u=a[s],dh(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.Uo?[3,7]:(c=[],h=Promise.resolve(),n.$o.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return dl(n,e),Sc(n.localStore,e,!0)})),yh(n.remoteStore,e)})),[4,h]);case 4:return i.sent(),[4,Dl(n,c)];case 5:return i.sent(),(l=hi(n)).ko.forEach((function(t,e){yh(l.remoteStore,e)})),l.Mo.cs(),l.ko=new Map,l.Oo=new Ns(Ni.comparator),n.Uo=!1,[4,Rh(n.remoteStore,!1)];case 6:i.sent(),i.label=7;case 7:return[2]}var l}))}))}function Dl(t,e,n){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l,f,p,d,y,v;return i(this,(function(i){switch(i.label){case 0:n=hi(t),r=[],o=[],s=0,a=e,i.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.$o.get(u))&&0!==h.length?[4,_c(n.localStore,xo(h[0]))]:[3,7]):[3,13];case 2:c=i.sent(),l=0,f=h,i.label=3;case 3:return l<f.length?(p=f[l],d=n.No.get(p),[4,Il(n,d)]):[3,6];case 4:(y=i.sent()).snapshot&&o.push(y.snapshot),i.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,Ac(n.localStore,u)];case 8:return v=i.sent(),[4,_c(n.localStore,v)];case 9:return c=i.sent(),[4,rl(n,Al(v),u,!1)];case 10:i.sent(),i.label=11;case 11:r.push(c),i.label=12;case 12:return s++,[3,1];case 13:return[2,(n.xo.Tr(o),r)]}}))}))}function Al(t){return To(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Nl(t){var e=hi(t);return hi(hi(e.localStore).persistence).gn()}function Cl(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a;return i(this,(function(i){switch(i.label){case 0:return(r=hi(t)).Uo?(ii("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!r.$o.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Nc(r.localStore)];case 3:return s=i.sent(),a=Ks.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,bl(r,s,a)];case 4:return i.sent(),[3,8];case 5:return[4,Sc(r.localStore,e,!0)];case 6:return i.sent(),dl(r,e,o),[3,8];case 7:ui(),i.label=8;case 8:return[2]}}))}))}function kl(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u,c,h,l,f,p;return i(this,(function(d){switch(d.label){case 0:if(!(r=xl(t)).Uo)return[3,10];o=0,s=e,d.label=1;case 1:return o<s.length?(a=s[o],r.$o.has(a)?(ii("SyncEngine","Adding an already active target "+a),[3,5]):[4,Ac(r.localStore,a)]):[3,6];case 2:return u=d.sent(),[4,_c(r.localStore,u)];case 3:return c=d.sent(),[4,rl(r,Al(u),c.targetId,!1)];case 4:d.sent(),dh(r.remoteStore,c),d.label=5;case 5:return o++,[3,1];case 6:h=function(t){return i(this,(function(e){switch(e.label){case 0:return r.$o.has(t)?[4,Sc(r.localStore,t,!1).then((function(){yh(r.remoteStore,t),dl(r,t)})).catch(Hu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,d.label=7;case 7:return l<f.length?(p=f[l],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function xl(t){var e=hi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=sl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=El.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ul.bind(null,e),e.xo.Tr=Qh.bind(null,e.eventManager),e.xo.Ko=Hh.bind(null,e.eventManager),e}function Ol(t){var e=hi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=cl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=hl.bind(null,e),e}var Ll=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.D=ih(t.databaseInfo.databaseId),this.sharedClientState=this.jo(t),this.persistence=this.Go(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.zo(t),this.localStore=this.Ho(t),[2]}}))}))},t.prototype.zo=function(t){return null},t.prototype.Ho=function(t){return mc(this.persistence,new vc,t.initialUser,this.D)},t.prototype.Go=function(t){return new Fc(Uc.Cs,this.D)},t.prototype.jo=function(t){return new Xc},t.prototype.terminate=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),Rl=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Jo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return e(n,t),n.prototype.initialize=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Cc(this.localStore)];case 2:return n.sent(),[4,this.Jo.initialize(this,e)];case 3:return n.sent(),[4,Ol(this.Jo.syncEngine)];case 4:return n.sent(),[4,Ah(this.Jo.remoteStore)];case 5:return n.sent(),[2]}}))}))},n.prototype.Ho=function(t){return mc(this.persistence,new vc,t.initialUser,this.D)},n.prototype.zo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Xu(e,t.asyncQueue)},n.prototype.Go=function(t){var e=pc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ru.withCacheSize(this.cacheSizeBytes):Ru.DEFAULT;return new hc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,nh(),rh(),this.D,this.sharedClientState,!!this.forceOwnership)},n.prototype.jo=function(t){return new Xc},n}(Ll),Pl=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Jo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return e(n,t),n.prototype.initialize=function(e){return r(this,void 0,void 0,(function(){var n,o=this;return i(this,(function(s){switch(s.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return s.sent(),n=this.Jo.syncEngine,this.sharedClientState instanceof Yc?(this.sharedClientState.syncEngine={wi:_l.bind(null,n),_i:Cl.bind(null,n),mi:kl.bind(null,n),gn:Nl.bind(null,n),di:Tl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:s.sent(),s.label=3;case 3:return[4,this.persistence.en((function(t){return r(o,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,Sl(this.Jo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return s.sent(),[2]}}))}))},n.prototype.jo=function(t){var e=nh();if(!Yc.At(e))throw new Ti(Ii.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=pc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Yc(e,t.asyncQueue,n,t.clientId,t.initialUser)},n}(Rl),Ml=function(){function t(){}return t.prototype.initialize=function(t,e){return r(this,void 0,void 0,(function(){var n=this;return i(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return al(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=wl.bind(null,this.syncEngine),[4,Rh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new Kh},t.prototype.createDatastore=function(t){var e,n,r=ih(t.databaseInfo.databaseId),i=(e=t.databaseInfo,new eh(e));return n=t.credentials,new ch(n,i,r)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return al(s.syncEngine,t,0)},o=$c.At()?new $c:new Jc,new lh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=t.initialUser,a=t.maxConcurrentLimboResolutions,u=e,c=new el(n,r,i,o,s,a),u&&(c.Uo=!0),c;var n,r,i,o,s,a,u,c},t.prototype.terminate=function(){return function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=hi(t),ii("RemoteStore","RemoteStore shutting down."),e.Qr.add(5),[4,ph(e)];case 1:return n.sent(),e.Wr.shutdown(),e.jr.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),Fl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.Yo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Xo=function(){this.muted=!0},t.prototype.Yo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),Vl=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(o){switch(o.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Ti(Ii.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return n=hi(t),r=la(n.D)+"/documents",o={documents:e.map((function(t){return aa(n.D,t)}))},[4,n.Ui("BatchGetDocuments",r,o)];case 1:return s=i.sent(),a=new Map,s.forEach((function(t){var e,r,i=(e=n.D,"found"in(r=t)?function(t,e){ci(!!e.found),e.found.name,e.found.updateTime;var n=ua(t,e.found.name),r=ia(e.found.updateTime),i=new jo({mapValue:{fields:e.found.fields}});return new $i(n,r,i,{})}(e,r):"missing"in r?function(t,e){ci(!!e.missing),ci(!!e.readTime);var n=ua(t,e.missing),r=ia(e.readTime);return new Zi(n,r)}(e,r):ui());a.set(i.key.toString(),i)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());ci(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=o.sent()).forEach((function(t){t instanceof Zi||t instanceof $i?n.recordVersion(t):ui()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastWriteError=n}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Ts(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return r(this,void 0,void 0,(function(){var t,e=this;return i(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Ni.fromPath(n);e.mutations.push(new _s(r,e.precondition(r)))})),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=hi(t),r=la(n.D)+"/documents",o={writes:e.map((function(t){return da(n.D,t)}))},[4,n.Mi("Commit",r,o)];case 1:return i.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t instanceof $i)e=t.version;else{if(!(t instanceof Zi))throw ui();e=Uo.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Ti(Ii.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?as.updateTime(e):as.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Uo.min()))throw new Ti(Ii.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return as.updateTime(e)}return as.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),Ul=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.cc=5,this.rr=new oh(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ac()},t.prototype.ac=function(){var t=this;this.rr.Yi((function(){return r(t,void 0,void 0,(function(){var t,e,n=this;return i(this,(function(r){return t=new Vl(this.datastore),(e=this.uc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.hc(t)}))}))})).catch((function(t){n.hc(t)})),[2]}))}))}))},t.prototype.uc=function(t){try{var e=this.updateFunction(t);return!bi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}},t.prototype.hc=function(t){var e=this;this.cc>0&&this.lc(t)?(this.cc-=1,this.asyncQueue.enqueueAndForget((function(){return e.ac(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.lc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ds(e)}return!1},t}(),ql=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=qc.UNAUTHENTICATED,this.clientId=fi.u(),this.credentialListener=function(){},this.receivedInitialUser=new Za,this.credentials.setChangeListener((function(t){ii("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Ti(Ii.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Za;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return r(t,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Vh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function jl(t,e){return r(this,void 0,void 0,(function(){var n,o,s=this;return i(this,(function(a){switch(a.label){case 0:return t.asyncQueue.verifyOperationInProgress(),ii("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=a.sent(),[4,e.initialize(n)];case 2:return a.sent(),o=n.initialUser,t.setCredentialChangeListener((function(n){o.isEqual(n)||(o=n,t.asyncQueue.enqueueRetryable((function(){return r(s,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,bc(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Bl(t,e){return r(this,void 0,void 0,(function(){var n,o;return i(this,(function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Kl(t)];case 1:return n=s.sent(),ii("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return o=s.sent(),[4,e.initialize(n,o)];case 3:return s.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return(n=hi(t)).asyncQueue.verifyOperationInProgress(),ii("RemoteStore","RemoteStore received new credentials"),r=wh(n),n.Qr.add(3),[4,ph(n)];case 1:return i.sent(),r&&n.jr.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Qr.delete(3),[4,fh(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function Kl(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(ii("FirestoreClient","Using default OfflineComponentProvider"),[4,jl(t,new Ll)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function Gl(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(ii("FirestoreClient","Using default OnlineComponentProvider"),[4,Bl(t,new Ml)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function zl(t){return Kl(t).then((function(t){return t.persistence}))}function Ql(t){return Kl(t).then((function(t){return t.localStore}))}function Hl(t){return Gl(t).then((function(t){return t.remoteStore}))}function Wl(t){return Gl(t).then((function(t){return t.syncEngine}))}function Yl(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,Gl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=nl.bind(null,e.syncEngine),n.onUnlisten=il.bind(null,e.syncEngine),n)]}}))}))}function Xl(t,e,n){var o=this;void 0===n&&(n={});var s=new Za;return t.asyncQueue.enqueueAndForget((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new Fl({next:function(o){e.enqueueAndForget((function(){return zh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Ti(Ii.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Ti(Ii.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Yh(_o(n.path),o,{includeMetadataChanges:!0,uo:!0});return Gh(t,s)},[4,Yl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}function Jl(t,e,n){var o=this;void 0===n&&(n={});var s=new Za;return t.asyncQueue.enqueueAndForget((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new Fl({next:function(n){e.enqueueAndForget((function(){return zh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Ti(Ii.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Yh(n,o,{includeMetadataChanges:!0,uo:!0});return Gh(t,s)},[4,Yl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}var $l=function(t,e,n,r,i,o){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},Zl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),tf=new Map,ef=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},nf=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(qc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),rf=function(){function t(t){var e=this;this.fc=null,this.currentUser=qc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.dc=0,this.changeListener=null,this.forceRefresh=!1,this.fc=function(){e.dc++,e.currentUser=e.wc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.dc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.fc):(this.fc(null),t.get().then((function(t){e.auth=t,e.fc&&e.auth.addAuthTokenListener(e.fc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.dc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.dc!==e?(ii("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(ci("string"==typeof n.accessToken),new ef(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.fc),this.fc=null,this.changeListener=null},t.prototype.wc=function(){var t=this.auth&&this.auth.getUid();return ci(null===t||"string"==typeof t),new qc(t)},t}(),of=function(){function t(t,e){this._c=t,this.mc=e,this.type="FirstParty",this.user=qc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.mc},e=this._c.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),sf=function(){function t(t,e){this._c=t,this.mc=e}return t.prototype.getToken=function(){return Promise.resolve(new of(this._c,this.mc))},t.prototype.setChangeListener=function(t){t(qc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function af(t,e,n){if(!n)throw new Ti(Ii.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function uf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function cf(t,e,n,r){if(!0===e&&!0===r)throw new Ti(Ii.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function hf(t){if(!Ni.isDocumentKey(t))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function lf(t){if(Ni.isDocumentKey(t))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function ff(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":ui()}function pf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ti(Ii.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ff(t);throw new Ti(Ii.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function df(t,e){if(e<=0)throw new Ti(Ii.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yf=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Ti(Ii.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ti(Ii.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,cf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),vf=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new yf({}),this._settingsFrozen=!1,t instanceof Zl?(this._databaseId=t,this._credentials=new nf):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ti(Ii.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zl(t.options.projectId)}(t),this._credentials=new rf(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Ti(Ii.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Ti(Ii.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yf(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new nf;switch(t.type){case"gapi":var e=t.client;return ci(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new sf(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Ti(Ii.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=tf.get(this))&&(ii("ComponentProvider","Removing Datastore"),tf.delete(this),t.terminate()),Promise.resolve();var t},t}(),gf=function(t){this._delegate=t},mf=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new wf(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),bf=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),wf=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,_o(r))||this).firestore=e,i._path=r,i.type="collection",i}return e(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new mf(this.firestore,null,new Ni(t))},enumerable:!1,configurable:!0}),n.prototype.withConverter=function(t){return new n(this.firestore,t,this._path)},n}(bf);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ef(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof gf&&(t=t._delegate),af("collection","path",e),t instanceof vf)return lf(n=Si.fromString.apply(Si,s([e],r))),new wf(t,null,n);if(!(t instanceof mf||t instanceof wf))throw new Ti(Ii.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return lf(n=Si.fromString.apply(Si,s([t.path],r)).child(Si.fromString(e))),new wf(t.firestore,null,n)}function If(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof gf&&(t=t._delegate),1===arguments.length&&(e=fi.u()),af("doc","path",e),t instanceof vf)return hf(n=Si.fromString.apply(Si,s([e],r))),new mf(t,null,new Ni(n));if(!(t instanceof mf||t instanceof wf))throw new Ti(Ii.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return hf(n=t._path.child(Si.fromString.apply(Si,s([e],r)))),new mf(t.firestore,t instanceof wf?t._converter:null,new Ni(n))}function Tf(t,e){return t instanceof gf&&(t=t._delegate),e instanceof gf&&(e=e._delegate),(t instanceof mf||t instanceof wf)&&(e instanceof mf||e instanceof wf)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function _f(t,e){return t instanceof gf&&(t=t._delegate),e instanceof gf&&(e=e._delegate),t instanceof bf&&e instanceof bf&&t.firestore===e.firestore&&Lo(t._query,e._query)&&t._converter===e._converter}var Sf=function(){function t(){var t=this;this.yc=Promise.resolve(),this.gc=[],this.Ec=!1,this.Tc=[],this.Ic=null,this.Ac=!1,this.Rc=[],this.rr=new oh(this,"async_queue_retry"),this.bc=function(){var e=rh();e&&ii("AsyncQueue","Visibility state changed to "+e.visibilityState),t.rr.Zi()};var e=rh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.Ec},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.vc(),this.Pc(t)},t.prototype.enterRestrictedMode=function(){if(!this.Ec){this.Ec=!0;var t=rh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}},t.prototype.enqueue=function(t){return this.vc(),this.Ec?new Promise((function(t){})):this.Pc(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.gc.push(t),e.Vc()}))},t.prototype.Vc=function(){return r(this,void 0,void 0,(function(){var t,e=this;return i(this,(function(n){switch(n.label){case 0:if(0===this.gc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.gc[0]()];case 2:return n.sent(),this.gc.shift(),this.rr.reset(),[3,4];case 3:if(!ou(t=n.sent()))throw t;return ii("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.gc.length>0&&this.rr.Yi((function(){return e.Vc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Pc=function(t){var e=this,n=this.yc.then((function(){return e.Ac=!0,t().catch((function(t){throw e.Ic=t,e.Ac=!1,oi("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",n.stack&&(r=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),r)),t;var n,r})).then((function(t){return e.Ac=!1,t}))}));return this.yc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.vc(),this.Rc.indexOf(t)>-1&&(e=0);var i=Fh.createAndSchedule(this,t,e,n,(function(t){return r.Sc(t)}));return this.Tc.push(i),i},t.prototype.vc=function(){this.Ic&&ui()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Dc=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,t=this.yc];case 1:e.sent(),e.label=2;case 2:if(t!==this.yc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Cc=function(t){for(var e=0,n=this.Tc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.xc=function(t){var e=this;return this.Dc().then((function(){e.Tc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.Tc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Dc()}))},t.prototype.Nc=function(t){this.Rc.push(t)},t.prototype.Sc=function(t){var e=this.Tc.indexOf(t);this.Tc.splice(e,1)},t}();function Df(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Af=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Sf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return e(n,t),n.prototype._terminate=function(){return this._firestoreClient||Cf(this),this._firestoreClient.terminate()},n}(vf);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(t){return t._firestoreClient||Cf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Cf(t){var e,n,r,i=t._freezeSettings(),o=(e=t._databaseId,n=t._persistenceKey,new $l(e,n,(r=i).host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t._firestoreClient=new ql(t._credentials,t._queue,o)}function kf(t,e,n){var o=this,s=new Za;return t.asyncQueue.enqueue((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,jl(t,n)];case 1:return i.sent(),[4,Bl(t,e)];case 2:return i.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(o=r=i.sent()).name?o.code===Ii.FAILED_PRECONDITION||o.code===Ii.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),s.reject(r),[3,4];case 4:return[2]}var o}))}))})).then((function(){return s.promise}))}function xf(t){if(t._initialized||t._terminated)throw new Ti(Ii.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Of=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ai(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Lf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Ci.fromBase64String(e))}catch(n){throw new Ti(Ii.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},t.fromUint8Array=function(e){return new t(Ci.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Rf=function(t){this._methodName=t},Pf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ti(Ii.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ti(Ii.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return pi(this._lat,t._lat)||pi(this._long,t._long)},t}(),Mf=/^__.*__$/,Ff=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new vs(t,this.data,this.fieldMask,e,this.fieldTransforms):new ys(t,this.data,e,this.fieldTransforms)},t}(),Vf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new vs(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ui()}}var qf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.D=n,this.ignoreUndefinedProperties=r,void 0===i&&this.$c(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Fc",{get:function(){return this.settings.Fc},enumerable:!1,configurable:!0}),t.prototype.Oc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.D,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Oc({path:n,Mc:!1});return r.Lc(t),r},t.prototype.Bc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Oc({path:n,Mc:!1});return r.$c(),r},t.prototype.qc=function(t){return this.Oc({path:void 0,Mc:!0})},t.prototype.Uc=function(t){return sp(t,this.settings.methodName,this.settings.Qc||!1,this.path,this.settings.Kc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.$c=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Lc(this.path.get(t))},t.prototype.Lc=function(t){if(0===t.length)throw this.Uc("Document fields must not be empty");if(Uf(this.Fc)&&Mf.test(t))throw this.Uc('Document fields cannot begin and end with "__"')},t}(),jf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.D=n||ih(t)}return t.prototype.Wc=function(t,e,n,r){return void 0===r&&(r=!1),new qf({Fc:t,methodName:e,Kc:n,path:Ai.emptyPath(),Mc:!1,Qc:r},this.databaseId,this.D,this.ignoreUndefinedProperties)},t}();function Bf(t){var e=t._freezeSettings(),n=ih(t._databaseId);return new jf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Kf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Wc(o.merge||o.mergeFields?2:0,e,n,i);np("Data must be an object, but it was:",s,r);var a,u,c=tp(r,s);if(o.merge)a=new qo(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=rp(e,f[l],n);if(!s.contains(p))throw new Ti(Ii.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");ap(h,p)||h.push(p)}a=new qo(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Ff(new jo(c),a,u)}var Gf=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._toFieldTransform=function(t){if(2!==t.Fc)throw 1===t.Fc?t.Uc(this._methodName+"() can only appear at the top level of your update data"):t.Uc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(Rf);function zf(t,e,n){return new qf({Fc:3,Kc:e.settings.Kc,methodName:t._methodName,Mc:n},e.databaseId,e.D,e.ignoreUndefinedProperties)}var Qf=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._toFieldTransform=function(t){return new os(t.path,new Jo)},n.prototype.isEqual=function(t){return t instanceof n},n}(Rf),Hf=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).jc=n,r}return e(n,t),n.prototype._toFieldTransform=function(t){var e=zf(this,t,!0),n=this.jc.map((function(t){return Zf(t,e)})),r=new $o(n);return new os(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Rf),Wf=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).jc=n,r}return e(n,t),n.prototype._toFieldTransform=function(t){var e=zf(this,t,!0),n=this.jc.map((function(t){return Zf(t,e)})),r=new ts(n);return new os(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Rf),Yf=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).Gc=n,r}return e(n,t),n.prototype._toFieldTransform=function(t){var e=new ns(t.D,Qo(t.D,this.Gc));return new os(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(Rf);function Xf(t,e,n,r){var i=t.Wc(1,e,n);np("Data must be an object, but it was:",i,r);var o=[],s=new Bo;gi(r,(function(t,r){var a=op(e,t,n);r instanceof gf&&(r=r._delegate);var u=i.Bc(a);if(r instanceof Gf)o.push(a);else{var c=Zf(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new qo(o);return new Vf(s.v(),a,i.fieldTransforms)}function Jf(t,e,n,r,i,o){var s=t.Wc(1,e,n),a=[rp(e,r,n)],u=[i];if(o.length%2!=0)throw new Ti(Ii.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(rp(e,o[c])),u.push(o[c+1]);for(var h=[],l=new Bo,f=a.length-1;f>=0;--f)if(!ap(h,a[f])){var p=a[f],d=u[f];d instanceof gf&&(d=d._delegate);var y=s.Bc(p);if(d instanceof Gf)h.push(p);else{var v=Zf(d,y);null!=v&&(h.push(p),l.set(p,v))}}var g=new qo(h);return new Vf(l.v(),g,s.fieldTransforms)}function $f(t,e,n,r){return void 0===r&&(r=!1),Zf(n,t.Wc(r?4:3,e))}function Zf(t,e){if(t instanceof gf&&(t=t._delegate),ep(t))return np("Unsupported field value:",e,t),tp(t,e);if(t instanceof Rf)return function(t,e){if(!Uf(e.Fc))throw e.Uc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Uc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Mc&&4!==e.Fc)throw e.Uc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Zf(o[i],e.qc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof gf&&(t=t._delegate),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Qo(e.D,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ri.fromDate(t);return{timestampValue:ea(e.D,n)}}if(t instanceof Ri)return n=new Ri(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ea(e.D,n)};if(t instanceof Pf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Lf)return{bytesValue:na(e.D,t._byteString)};if(t instanceof mf){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Uc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:oa(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Uc("Unsupported field value: "+ff(t))}(t,e)}function tp(t,e){var n={};return mi(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gi(t,(function(t,r){var i=Zf(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function ep(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ri||t instanceof Pf||t instanceof Lf||t instanceof mf||t instanceof Rf)}function np(t,e,n){if(!ep(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=ff(n);throw"an object"===r?e.Uc(t+" a custom object"):e.Uc(t+" "+r)}var i}function rp(t,e,n){if(e instanceof gf&&(e=e._delegate),e instanceof Of)return e._internalPath;if("string"==typeof e)return op(t,e);throw sp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var ip=new RegExp("[~\\*/\\[\\]]");function op(t,e,n){if(e.search(ip)>=0)throw sp("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Of.bind.apply(Of,s([void 0],e.split(".")))))._internalPath}catch(r){throw sp("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function sp(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Ti(Ii.INVALID_ARGUMENT,(a+=". ")+t+u)}function ap(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var up=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new mf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new cp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data().field(hp("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),cp=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.data=function(){return t.prototype.data.call(this)},n}(up);function hp(t,e){return"string"==typeof e?op(t,e):e instanceof gf?e._delegate._internalPath:e._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lp=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),fp=function(t){function n(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return e(n,t),n.prototype.exists=function(){return t.prototype.exists.call(this)},n.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new pp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.toProto(),t.serverTimestamps)}},n.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data().field(hp("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},n}(up),pp=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},n}(fp),dp=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new lp(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new pp(n._firestore,n._userDataWriter,r.key,r,new lp(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ti(Ii.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new pp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new lp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new pp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new lp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:yp(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function yp(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ui()}}function vp(t,e){return t instanceof fp&&e instanceof fp?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof dp&&e instanceof dp&&t._firestore===e._firestore&&_f(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gp(t){if(Do(t)&&0===t.explicitOrderBy.length)throw new Ti(Ii.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var mp=function(){};function bp(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var wp=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).zc=e,i.Hc=n,i.Jc=r,i.type="where",i}return e(n,t),n.prototype._apply=function(t){var e,n,r,i=Bf(t.firestore),o=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Ap(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(Dp(r,t,l))}a={arrayValue:{values:u}}}else a=Dp(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Ap(s,o),a=$f(n,"where",s,"in"===o||"not-in"===o);var f=so.create(i,o,a);return function(t,e){if(e.g()){var n=No(t);if(null!==n&&!n.isEqual(e.field))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Ao(t);null!==r&&Np(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Ti(Ii.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Ti(Ii.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,i,t.firestore._databaseId,this.zc,this.Hc,this.Jc);return new bf(t.firestore,t._converter,(e=t._query,n=o,r=e.filters.concat([n]),new Io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)))},n}(mp),Ep=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).zc=e,r.Yc=n,r.type="orderBy",r}return e(n,t),n.prototype._apply=function(t){var e,n,r,i=function(t,e,n){if(null!==t.startAt)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new mo(e,n);return function(t,e){if(null===Ao(t)){var n=No(t);null!==n&&Np(t,n,e.field)}}(t,r),r}(t._query,this.zc,this.Yc);return new bf(t.firestore,t._converter,(e=t._query,n=i,r=e.explicitOrderBy.concat([n]),new Io(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},n}(mp),Ip=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Xc=n,i.Zc=r,i}return e(n,t),n.prototype._apply=function(t){return new bf(t.firestore,t._converter,Oo(t._query,this.Xc,this.Zc))},n}(mp),Tp=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ta=n,i.ea=r,i}return e(n,t),n.prototype._apply=function(t){var e,n,r=Sp(t,this.type,this.ta,this.ea);return new bf(t.firestore,t._converter,(e=t._query,n=r,new Io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,n,e.endAt)))},n}(mp),_p=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ta=n,i.ea=r,i}return e(n,t),n.prototype._apply=function(t){var e,n,r=Sp(t,this.type,this.ta,this.ea);return new bf(t.firestore,t._converter,(e=t._query,n=r,new Io(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,n)))},n}(mp);function Sp(t,e,n,r){if(n[0]instanceof gf&&(n[0]=n[0]._delegate),n[0]instanceof up)return function(t,e,n,r,i){if(!r)throw new Ti(Ii.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=ko(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(zi(e,r.key));else{var c=r.field(u.field);if(Pi(c))throw new Ti(Ii.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new vo(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Bf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Ti(Ii.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Co(t)&&-1!==c.indexOf("/"))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Si.fromString(c));if(!Ni.isDocumentKey(h))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Ni(h);a.push(zi(e,l))}else{var f=$f(n,r,c);a.push(f)}}return new vo(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Dp(t,e,n){if(n instanceof gf&&(n=n._delegate),"string"==typeof n){if(""===n)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Co(e)&&-1!==n.indexOf("/"))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Si.fromString(n));if(!Ni.isDocumentKey(r))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return zi(t,new Ni(r))}if(n instanceof mf)return zi(t,n._key);throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ff(n)+".")}function Ap(t,e){if(!Array.isArray(t)||0===t.length)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Np(t,e,n){if(!n.isEqual(e))throw new Ti(Ii.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cp=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Vi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Oi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Li(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw ui()}},t.prototype.convertObject=function(t,e){var n=this,r={};return gi(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Pf(Oi(t.latitude),Oi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Mi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Fi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=xi(t);return new Ri(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Si.fromString(t);ci(Ca(n));var r=new Zl(n.get(1),n.get(3)),i=new Ni(n.popFirst(5));return r.isEqual(e)||oi("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var xp=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return e(n,t),n.prototype.convertBytes=function(t){return new Lf(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new mf(this.firestore,null,e)},n}(Cp),Op=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Bf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Lp(t,this._firestore),i=kp(r._converter,e,n),o=Kf(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,as.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Lp(t,this._firestore);return e instanceof gf&&(e=e._delegate),o="string"==typeof e||e instanceof Of?Jf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Xf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,as.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Lp(t,this._firestore);return this._mutations=this._mutations.concat(new Ts(e._key,as.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Ti(Ii.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lp(t,e){if(t instanceof gf&&(t=t._delegate),t.firestore!==e)throw new Ti(Ii.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rp=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return e(n,t),n.prototype.convertBytes=function(t){return new Lf(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new mf(this.firestore,null,e)},n}(Cp);function Pp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=pf(t,mf);var o=pf(t.firestore,Af),s=Bf(o);return e instanceof gf&&(e=e._delegate),Fp(o,[("string"==typeof e||e instanceof Of?Jf(s,"updateDoc",t._key,e,n,r):Xf(s,"updateDoc",t._key,e)).toMutation(t._key,as.exists(!0))])}function Mp(t){for(var e,n,o,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t instanceof gf&&(t=t._delegate);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||Df(s[c])||(u=s[c],c++);var h,l,f,p={includeMetadataChanges:u.includeMetadataChanges};if(Df(s[c])){var d=s[c];s[c]=null===(e=d.next)||void 0===e?void 0:e.bind(d),s[c+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),s[c+2]=null===(o=d.complete)||void 0===o?void 0:o.bind(d)}if(t instanceof mf)l=pf(t.firestore,Af),f=_o(t._key.path),h={next:function(e){s[c]&&s[c](Vp(l,t,e))},error:s[c+1],complete:s[c+2]};else{var y=pf(t,bf);l=pf(y.firestore,Af),f=y._query;var v=new Rp(l);h={next:function(t){s[c]&&s[c](new dp(l,v,y,t))},error:s[c+1],complete:s[c+2]},gp(t._query)}return function(t,e,n,o){var s=this,a=new Fl(o),u=new Yh(e,a,n);return t.asyncQueue.enqueueAndForget((function(){return r(s,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=Gh,[4,Yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){a.Xo(),t.asyncQueue.enqueueAndForget((function(){return r(s,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=zh,[4,Yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(Nf(l),f,p,h)}function Fp(t,e){return function(t,e){var n=this,o=new Za;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=ol,[4,Wl(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,o])]}}))}))})),o.promise}(Nf(t),e)}function Vp(t,e,n){var r=n.docs.get(e._key),i=new Rp(t);return new fp(t,i,e._key,r,new lp(n.hasPendingWrites,n.fromCache),e._converter)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Up=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return e(n,t),n.prototype.get=function(e){var n=this,r=Lp(e,this._firestore),i=new Rp(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new fp(n._firestore,i,r._key,t._document,new lp(!1,!1),r._converter)}))},n}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Bf(t)}return t.prototype.get=function(t){var e=this,n=Lp(t,this._firestore),r=new xp(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return ui();var i=t[0];if(i instanceof Zi)return new up(e._firestore,r,n._key,null,n._converter);if(i instanceof $i)return new up(e._firestore,r,i.key,i,n._converter);throw ui()}))},t.prototype.set=function(t,e,n){var r=Lp(t,this._firestore),i=kp(r._converter,e,n),o=Kf(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Lp(t,this._firestore);return e instanceof gf&&(e=e._delegate),o="string"==typeof e||e instanceof Of?Jf(this._dataReader,"Transaction.update",s._key,e,n,r):Xf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Lp(t,this._firestore);return this._transaction.delete(e._key),this},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(){if("undefined"==typeof Uint8Array)throw new Ti(Ii.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function jp(){if("undefined"==typeof atob)throw new Ti(Ii.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Bp=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.fromBase64String=function(t){return jp(),new n(Lf.fromBase64String(t))},n.fromUint8Array=function(t){return qp(),new n(Lf.fromUint8Array(t))},n.prototype.toBase64=function(){return jp(),this._delegate.toBase64()},n.prototype.toUint8Array=function(){return qp(),this._delegate.toUint8Array()},n.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},n.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},n}(gf),Kp=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){xf(t=pf(t,Af));var n=Nf(t),r=t._freezeSettings(),i=new Ml;return kf(n,i,new Rl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){xf(t=pf(t,Af));var e=Nf(t),n=t._freezeSettings(),r=new Ml;return kf(e,r,new Pl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Ti(Ii.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Za;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return nu.At()?(e=t+"main",[4,nu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(pc(t._databaseId,t._persistenceKey))];case 1:return o.sent(),n.resolve(),[3,3];case 2:return e=o.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),Gp=function(t){function n(e,n,r){var i=this;return(i=t.call(this,n)||this).na=r,i.INTERNAL={delete:function(){return i.terminate()}},e instanceof Zl||(i.sa=e),i}return e(n,t),Object.defineProperty(n.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),n.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},n.prototype.useEmulator=function(t,e){var n,r,i,o;n=this._delegate,r=t,i=e,"firestore.googleapis.com"!==(o=(n=pf(n,vf))._getSettings()).host&&o.host!==r&&si("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},o),{host:r+":"+i,ssl:!1}))},n.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return r(e,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,zl(t)];case 1:return e=r.sent(),[4,Hl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),i=n,o=hi(i),o.Qr.delete(0),fh(o))]}var i,o}))}))}))}(Nf(pf(this._delegate,Af)))},n.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return r(e,void 0,void 0,(function(){var e,n;return i(this,(function(o){switch(o.label){case 0:return[4,zl(t)];case 1:return e=o.sent(),[4,Hl(t)];case 2:return n=o.sent(),[2,(e.setNetworkEnabled(!1),function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=hi(t)).Qr.add(0),[4,ph(e)];case 1:return n.sent(),e.jr.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Nf(pf(this._delegate,Af)))},n.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&cf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.na.enableMultiTabIndexedDbPersistence(this):this.na.enableIndexedDbPersistence(this,n)},n.prototype.clearPersistence=function(){return this.na.clearIndexedDbPersistence(this)},n.prototype.terminate=function(){return this.sa&&(this.sa._removeServiceInstance("firestore"),this.sa._removeServiceInstance("firestore-exp")),this._delegate._delete()},n.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Za;return t.asyncQueue.enqueueAndForget((function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:return e=ll,[4,Wl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Nf(pf(this._delegate,Af)))},n.prototype.onSnapshotsInSync=function(t){return e=this._delegate,n=t,function(t,e){var n=this,o=new Fl(e);return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=function(t,e){hi(t).Zr.add(e),e.next()},[4,Yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){o.Xo(),t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=function(t,e){hi(t).Zr.delete(e)},[4,Yl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(Nf(e=pf(e,Af)),Df(n)?n:{next:n});var e,n},Object.defineProperty(n.prototype,"app",{get:function(){if(!this.sa)throw new Ti(Ii.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.sa},enumerable:!1,configurable:!0}),n.prototype.collection=function(t){try{return new id(this,Ef(this._delegate,t))}catch(e){throw Xp(e,"collection()","Firestore.collection()")}},n.prototype.doc=function(t){try{return new Yp(this,If(this._delegate,t))}catch(e){throw Xp(e,"doc()","Firestore.doc()")}},n.prototype.collectionGroup=function(t){try{return new ed(this,function(t,e){if(t=pf(t,vf),af("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new bf(t,null,(n=e,new Io(Si.emptyPath(),n)));var n}(this._delegate,t))}catch(e){throw Xp(e,"collectionGroup()","Firestore.collectionGroup()")}},n.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,o=new Za;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,(i=t,Gl(i).then((function(t){return t.datastore})))];case 1:return n=r.sent(),new Ul(t.asyncQueue,n,e,o).run(),[2]}var i}))}))})),o.promise}(Nf(e=this._delegate),(function(r){return function(e){return t(new Qp(n,e))}(new Up(e,r))}))},n.prototype.batch=function(){var t=this;return Nf(this._delegate),new Hp(new Op(this._delegate,(function(e){return Fp(t._delegate,e)})))},n.prototype.loadBundle=function(t){throw new Ti(Ii.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},n.prototype.namedQuery=function(t){throw new Ti(Ii.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},n}(gf),zp=function(t){function n(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return e(n,t),n.prototype.convertBytes=function(t){return new Bp(new Lf(t))},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Yp.ia(e,this.firestore,null)},n}(Cp);var Qp=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r._userDataWriter=new zp(e),r}return e(n,t),n.prototype.get=function(t){var e=this,n=od(t);return this._delegate.get(n).then((function(t){return new Zp(e._firestore,new fp(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},n.prototype.set=function(t,e,n){var r=od(t);return n?(uf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},n.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=od(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,s([a,e,n],i)),this},n.prototype.delete=function(t){var e=od(t);return this._delegate.delete(e),this},n}(gf),Hp=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.set=function(t,e,n){var r=od(t);return n?(uf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},n.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var a=od(t);return 2===arguments.length?this._delegate.update(a,e):(r=this._delegate).update.apply(r,s([a,e,n],i)),this},n.prototype.delete=function(t){var e=od(t);return this._delegate.delete(e),this},n.prototype.commit=function(){return this._delegate.commit()},n}(gf),Wp=function(t){function n(e,n,r){var i=this;return(i=t.call(this,r)||this)._firestore=e,i._userDataWriter=n,i}return e(n,t),n.prototype.fromFirestore=function(t,e){var n=new pp(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new td(this._firestore,n),null!=e?e:{})},n.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},n.ra=function(t,e){var r=n.oa,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(e);return o||(o=new n(t,new zp(t),e),i.set(e,o)),o},n}(gf);Wp.oa=new WeakMap;var Yp=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r._userDataWriter=new zp(e),r}return e(n,t),n.ca=function(t,e,r){if(t.length%2!=0)throw new Ti(Ii.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new n(e,new mf(e._delegate,r,new Ni(t)))},n.ia=function(t,e,r){return new n(e,new mf(e._delegate,r,t))},Object.defineProperty(n.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return new id(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),n.prototype.collection=function(t){try{return new id(this.firestore,Ef(this._delegate,t))}catch(e){throw Xp(e,"collection()","DocumentReference.collection()")}},n.prototype.isEqual=function(t){return t instanceof gf&&(t=t._delegate),t instanceof mf&&Tf(this._delegate,t)},n.prototype.set=function(t,e){e=uf("DocumentReference.set",e);try{return function(t,e,n){t=pf(t,mf);var r=pf(t.firestore,Af),i=kp(t._converter,e,n);return Fp(r,[Kf(Bf(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,as.none())])}(this._delegate,t,e)}catch(n){throw Xp(n,"setDoc()","DocumentReference.set()")}},n.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Pp(this._delegate,t):Pp.apply(void 0,s([this._delegate,t,e],n))}catch(i){throw Xp(i,"updateDoc()","DocumentReference.update()")}},n.prototype.delete=function(){return Fp(pf((t=this._delegate).firestore,Af),[new Ts(t._key,as.none())]);var t},n.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Jp(e),i=$p(e,(function(e){return new Zp(t.firestore,new fp(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return Mp(this._delegate,r,i)},n.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=pf(t,mf);var e=pf(t.firestore,Af),n=Nf(e),o=new Rp(e);return function(t,e){var n=this,o=new Za;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(s=t,a=e,u=hi(s),u.persistence.runTransaction("read document","readonly",(function(t){return u.Kn.In(t,a)})))];case 1:return(o=i.sent())instanceof $i?n.resolve(o):o instanceof Zi?n.resolve(null):n.reject(new Ti(Ii.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=i.sent(),o=Vh(r,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}var s,a,u}))}))},[4,Ql(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(n,t._key).then((function(n){return new fp(e,o,t._key,n,new lp(n instanceof $i&&n.hasLocalMutations,!0),t._converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=pf(t,mf);var e=pf(t.firestore,Af);return Xl(Nf(e),t._key,{source:"server"}).then((function(n){return Vp(e,t,n)}))}(this._delegate):function(t){t=pf(t,mf);var e=pf(t.firestore,Af);return Xl(Nf(e),t._key).then((function(n){return Vp(e,t,n)}))}(this._delegate)).then((function(t){return new Zp(e.firestore,new fp(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(Wp.ra(this.firestore,t)):this._delegate.withConverter(null))},n}(gf);function Xp(t,e,n){return t.message=t.message.replace(e,n),t}function Jp(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Df(r))return r}return{}}function $p(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Df(t[0])?t[0]:Df(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Zp=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r}return e(n,t),Object.defineProperty(n.prototype,"ref",{get:function(){return new Yp(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),n.prototype.data=function(t){return this._delegate.data(t)},n.prototype.get=function(t,e){return this._delegate.get(t,e)},n.prototype.isEqual=function(t){return vp(this._delegate,t._delegate)},n}(gf),td=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.data=function(t){return this._delegate.data(t)},n}(Zp),ed=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r._userDataWriter=new zp(e),r}return e(n,t),n.prototype.where=function(t,e,r){try{return new n(this.firestore,bp(this._delegate,(o=r,s=e,a=hp("where",i=t),new wp(a,s,o))))}catch(i){throw Xp(i,/(orderBy|where)\(\)/,"Query.$1()")}var i,o,s,a},n.prototype.orderBy=function(t,e){try{return new n(this.firestore,bp(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=hp("orderBy",t);return new Ep(r,n)}(t,e)))}catch(r){throw Xp(r,/(orderBy|where)\(\)/,"Query.$1()")}},n.prototype.limit=function(t){try{return new n(this.firestore,bp(this._delegate,(df("limit",e=t),new Ip("limit",e,"F"))))}catch(e){throw Xp(e,"limit()","Query.limit()")}var e},n.prototype.limitToLast=function(t){try{return new n(this.firestore,bp(this._delegate,(df("limitToLast",e=t),new Ip("limitToLast",e,"L"))))}catch(e){throw Xp(e,"limitToLast()","Query.limitToLast()")}var e},n.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new n(this.firestore,bp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Tp("startAt",t,!0)}.apply(void 0,t)))}catch(r){throw Xp(r,"startAt()","Query.startAt()")}},n.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new n(this.firestore,bp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Tp("startAfter",t,!1)}.apply(void 0,t)))}catch(r){throw Xp(r,"startAfter()","Query.startAfter()")}},n.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new n(this.firestore,bp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new _p("endBefore",t,!0)}.apply(void 0,t)))}catch(r){throw Xp(r,"endBefore()","Query.endBefore()")}},n.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new n(this.firestore,bp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new _p("endAt",t,!1)}.apply(void 0,t)))}catch(r){throw Xp(r,"endAt()","Query.endAt()")}},n.prototype.isEqual=function(t){return _f(this._delegate,t._delegate)},n.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=pf(t,bf);var e=pf(t.firestore,Af),n=Nf(e),o=new Rp(e);return function(t,e){var n=this,o=new Za;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Dc(t,e,!0)];case 1:return u=i.sent(),r=new $h(e,u.jn),o=r.Io(u.documents),s=r.applyChanges(o,!1),n.resolve(s.snapshot),[3,3];case 2:return a=i.sent(),u=Vh(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,Ql(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(n,t._query).then((function(n){return new dp(e,o,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=pf(t,bf);var e=pf(t.firestore,Af),n=Nf(e),r=new Rp(e);return Jl(n,t._query,{source:"server"}).then((function(n){return new dp(e,r,t,n)}))}(this._delegate):function(t){t=pf(t,bf);var e=pf(t.firestore,Af),n=Nf(e),r=new Rp(e);return gp(t._query),Jl(n,t._query).then((function(n){return new dp(e,r,t,n)}))}(this._delegate)).then((function(t){return new rd(e.firestore,new dp(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},n.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Jp(e),i=$p(e,(function(e){return new rd(t.firestore,new dp(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Mp(this._delegate,r,i)},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(Wp.ra(this.firestore,t)):this._delegate.withConverter(null))},n}(gf),nd=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r}return e(n,t),Object.defineProperty(n.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"doc",{get:function(){return new td(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),n}(gf),rd=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this)._firestore=e,r}return e(n,t),Object.defineProperty(n.prototype,"query",{get:function(){return new ed(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new td(t._firestore,e)}))},enumerable:!1,configurable:!0}),n.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new nd(e._firestore,t)}))},n.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new td(n._firestore,r))}))},n.prototype.isEqual=function(t){return vp(this._delegate,t._delegate)},n}(gf),id=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return e(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Yp(this.firestore,t):null},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){try{return new Yp(this.firestore,void 0===t?If(this._delegate):If(this._delegate,t))}catch(e){throw Xp(e,"doc()","CollectionReference.doc()")}},n.prototype.add=function(t){var e,n,r,i,o,s=this;return(e=this._delegate,n=t,r=pf(e.firestore,Af),i=If(e),o=kp(e._converter,n),Fp(r,[Kf(Bf(e.firestore),"addDoc",i._key,o,null!==e._converter,{}).toMutation(i._key,as.exists(!1))]).then((function(){return i}))).then((function(t){return new Yp(s.firestore,t)}))},n.prototype.isEqual=function(t){return Tf(this._delegate,t._delegate)},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(Wp.ra(this.firestore,t)):this._delegate.withConverter(null))},n}(ed);function od(t){return t instanceof gf&&(t=t._delegate),pf(t,mf)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var sd,ad=function(t){function n(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,new(Of.bind.apply(Of,s([void 0],e))))||this}return e(n,t),n.documentId=function(){return new n(Ai.keyField().canonicalString())},n.prototype.isEqual=function(t){return t instanceof gf&&(t=t._delegate),t instanceof Of&&this._delegate._internalPath.isEqual(t._internalPath)},n}(gf),ud=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.serverTimestamp=function(){var t=new Qf("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new n(t)},n.delete=function(){var t=new Gf("deleteField");return t._methodName="FieldValue.delete",new n(t)},n.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("arrayUnion",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new n(r)},n.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wf("arrayRemove",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new n(r)},n.increment=function(t){var e=new Yf("increment",t);return e._methodName="FieldValue.increment",new n(e)},n.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},n}(gf),cd={Firestore:Gp,GeoPoint:Pf,Timestamp:Ri,Blob:Bp,Transaction:Qp,WriteBatch:Hp,DocumentReference:Yp,DocumentSnapshot:Zp,Query:ed,QueryDocumentSnapshot:td,QuerySnapshot:rd,CollectionReference:id,FieldPath:ad,FieldValue:ud,setLogLevel:function(t){var e;e=t,ni.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(sd=H).INTERNAL.registerComponent(new b("firestore",(function(t){return function(t,e){return new Gp(t,new Af(t,e),new Kp)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},cd))),sd.registerVersion("@firebase/firestore","2.2.1");export{H as f};
